<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JSON-LD Schema Viewer (Proxy Version)</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: #f5f7fa;
            min-height: 100vh;
            padding: 20px;
            color: #2c3e50;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 30px;
            padding: 20px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        h1 {
            font-size: 2rem;
            margin-bottom: 10px;
            font-weight: 600;
        }

        .subtitle {
            font-size: 1rem;
            color: #64748b;
        }

        .server-status {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            margin-top: 10px;
            background: #10b981;
            color: white;
        }

        .server-status.offline {
            background: #ef4444;
        }

        .input-section {
            background: white;
            border-radius: 8px;
            padding: 25px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            margin-bottom: 25px;
        }

        .input-group {
            display: flex;
            gap: 12px;
            margin-bottom: 15px;
        }

        input[type="url"] {
            flex: 1;
            padding: 12px 16px;
            font-size: 15px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            transition: all 0.2s ease;
        }

        input[type="url"]:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.1);
        }

        button {
            padding: 12px 24px;
            font-size: 15px;
            font-weight: 500;
            color: white;
            background: #3b82f6;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        button:hover {
            background: #2563eb;
        }

        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .sample-links {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            align-items: center;
        }

        .sample-links span {
            color: #64748b;
            font-size: 14px;
        }

        .sample-link {
            padding: 6px 12px;
            background: #f1f5f9;
            border-radius: 4px;
            font-size: 14px;
            color: #3b82f6;
            text-decoration: none;
            transition: all 0.2s ease;
            cursor: pointer;
            border: 1px solid #e2e8f0;
        }

        .sample-link:hover {
            background: #e2e8f0;
        }

        .results-section {
            display: none;
        }

        .results-section.active {
            display: block;
        }

        .schema-card {
            background: white;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .schema-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 20px;
            background: #f8fafc;
            border-bottom: 1px solid #e2e8f0;
        }

        .schema-type {
            display: inline-block;
            padding: 4px 12px;
            background: #3b82f6;
            color: white;
            border-radius: 4px;
            font-size: 14px;
            font-weight: 500;
        }

        .schema-controls {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        /* Docs links in header or card */
        .doc-links {
            display: flex;
            gap: 6px;
            flex-wrap: wrap;
            align-items: center;
        }

        .doc-pill {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 4px 10px;
            border: 1px solid #cbd5e1;
            border-radius: 999px;
            background: #ffffff;
            color: #334155;
            font-size: 12px;
            text-decoration: none;
            transition: all 0.15s ease;
        }

        .doc-pill:hover {
            background: #f8fafc;
            border-color: #94a3b8;
            color: #0f172a;
        }

        .view-toggle {
            display: flex;
            gap: 4px;
            background: #f1f5f9;
            padding: 2px;
            border-radius: 4px;
        }

        .view-toggle button {
            padding: 6px 12px;
            font-size: 13px;
            background: transparent;
            color: #64748b;
            min-width: 70px;
        }

        .view-toggle button.active {
            background: white;
            color: #3b82f6;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
        }

        .schema-index {
            color: #94a3b8;
            font-size: 14px;
        }

        .schema-content {
            padding: 20px;
        }

        /* Table View Styles */
        .table-view {
            overflow-x: auto;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 14px;
            table-layout: fixed;
        }

        .data-table th,
        .data-table td {
            text-align: left;
            padding: 12px;
            border-bottom: 1px solid #e2e8f0;
            vertical-align: top;
            box-sizing: border-box;
        }

        .data-table th {
            background: #f8fafc;
            font-weight: 600;
            color: #475569;
        }

        .data-table tr:hover {
            background: #f8fafc;
        }

        /* ÂàóÂπÖ„ÅÆÂÆâÂÆöÂåñ */
        .data-table col.col-prop {
            width: 26%;
        }

        .data-table col.col-value {
            width: auto;
        }

        .data-table col.col-type {
            width: 96px;
        }

        /* ÂÄ§„Ç´„É©„É†„ÅØÊäò„ÇäËøî„Åó„ÇíË®±ÂèØ */
        .data-table td:nth-child(2) {
            word-break: break-word;
            overflow-wrap: anywhere;
        }

        /* Âûã„Ç´„É©„É†„ÅØÊäò„ÇäËøî„ÅóÁ¶ÅÊ≠¢„ÉªÁúÅÁï•Ë°®Á§∫„ÅßÂ¥©„ÇåÂØæÁ≠ñ */
        .data-table th:nth-child(3),
        .data-table td:nth-child(3) {
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .property-name {
            font-weight: 500;
            color: #1e40af;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .property-value {
            color: #334155;
        }

        .property-type {
            display: inline-block;
            padding: 2px 6px;
            background: #f1f5f9;
            border-radius: 3px;
            font-size: 11px;
            color: #64748b;
            margin-left: 8px;
            font-weight: normal;
            max-width: 100%;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        /* Array List Styles */
        .array-list {
            background: #f8fafc;
            border-radius: 4px;
            padding: 12px;
            margin: 8px 0;
        }

        .array-list-item {
            background: white;
            padding: 10px;
            margin: 6px 0;
            border-radius: 4px;
            border-left: 3px solid #3b82f6;
        }

        /* Compact table for arrays with same structure */
        .compact-array-table {
            margin: 8px 0;
            width: 100%;
        }

        .compact-array-table th {
            background: #f1f5f9;
            font-size: 13px;
            padding: 8px 12px;
        }

        .compact-array-table td {
            padding: 8px 12px;
            font-size: 14px;
        }

        .nested-object {
            margin-left: 0;
            padding-left: 16px;
            border-left: 2px solid #e2e8f0;
            overflow-x: auto;
            /* Ê®™„Çπ„ÇØ„É≠„Éº„É´„ÇíË®±ÂèØ */
        }

        /* „Éç„Çπ„ÉàÊôÇ„ÅØÂàóÊØîÁéá„Çí„ÇÑ„ÇÑÂ§âÊõ¥„Åó„Å¶1ÂàóÁõÆ„ÇíÂ∫É„ÇÅ„Å´ */
        .nested-object .data-table col.col-prop {
            width: 32%;
        }

        .nested-object .data-table col.col-value {
            width: auto;
        }

        .nested-object .data-table col.col-type {
            width: 96px;
        }

        /* JSON View Styles */
        .json-view {
            background: #1e293b;
            border-radius: 6px;
            padding: 20px;
            overflow-x: auto;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 13px;
            line-height: 1.6;
            color: #cbd5e1;
        }

        .json-view.hidden {
            display: none;
        }

        .table-view.hidden {
            display: none;
        }

        .json-key {
            color: #7dd3fc;
        }

        .json-string {
            color: #86efac;
        }

        .json-number {
            color: #fbbf24;
        }

        .json-boolean {
            color: #f472b6;
        }

        .json-null {
            color: #94a3b8;
        }

        .json-bracket {
            color: #cbd5e1;
        }

        .copy-button {
            padding: 8px 16px;
            background: white;
            border: 1px solid #d1d5db;
            border-radius: 4px;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.2s ease;
            color: #475569;
        }

        .copy-button:hover {
            background: #f8fafc;
            border-color: #3b82f6;
            color: #3b82f6;
        }

        .copy-button.copied {
            background: #10b981;
            color: white;
            border-color: #10b981;
        }

        .error-message {
            background: #fef2f2;
            border: 1px solid #fecaca;
            border-radius: 6px;
            padding: 10px;
            /* Â∞è„Åï„ÇÅ„Å´ */
            color: #dc2626;
            margin: 10px 0 12px;
            /* ‰∏ä„Å´‰ΩôÁôΩ„ÄÅÂÖ®‰Ωì„Çí„Ç≥„É≥„Éë„ÇØ„Éà„Å´ */
            font-size: 13px;
            /* „ÉÜ„Ç≠„Çπ„Éà„ÇíÂ∞ë„ÅóÂ∞è„Åï„Åè */
            line-height: 1.4;
            display: none;
        }

        .error-message.active {
            display: block;
        }

        .loading {
            text-align: center;
            padding: 40px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            display: none;
        }

        .loading.active {
            display: block;
        }

        .spinner {
            border: 3px solid #e2e8f0;
            border-top: 3px solid #3b82f6;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        .stats {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            display: flex;
            gap: 40px;
            flex-wrap: wrap;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .stat-item {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .stat-label {
            color: #64748b;
            font-size: 13px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .stat-value {
            font-weight: 600;
            font-size: 20px;
            color: #1e293b;
        }

        .no-data {
            text-align: center;
            padding: 60px 20px;
            color: #64748b;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .no-data h3 {
            color: #475569;
            margin: 16px 0 8px;
        }

        /* Expandable Styles - Default Open */
        .expandable {
            cursor: pointer;
            user-select: none;
        }

        .expandable::before {
            content: '‚ñº';
            display: inline-block;
            margin-right: 6px;
            transition: transform 0.2s;
            font-size: 10px;
        }

        .expandable.collapsed::before {
            content: '‚ñ∂';
            transform: rotate(0deg);
        }

        .nested-content {
            display: block;
            margin-top: 8px;
        }

        .nested-content.collapsed {
            display: none;
        }

        .url-value {
            color: #3b82f6;
            text-decoration: none;
            word-break: break-all;
        }

        .url-value:hover {
            text-decoration: underline;
        }

        /* ÁîªÂÉè„Çµ„É†„Éç„Ç§„É´Ë°®Á§∫ */
        .image-value {
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .image-thumb {
            width: 48px;
            height: 48px;
            object-fit: contain;
            background: #fff;
            border: 1px solid #e2e8f0;
            border-radius: 4px;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.04);
        }
    </style>
</head>

<body>
    <div class="container">
        <header>
            <h1>JSON-LD Schema Viewer</h1>
            <p class="subtitle">Node.js„Éó„É≠„Ç≠„Ç∑„Çµ„Éº„Éê„ÉºÁâà - localhostÂØæÂøú</p>
            <span class="server-status" id="serverStatus">„Çµ„Éº„Éê„ÉºÁ¢∫Ë™ç‰∏≠...</span>
            <span>
                <a class="doc-pill" target="_blank" rel="noopener noreferrer"
                    href="https://developers.google.com/search/docs/appearance/structured-data/job-posting?hl=ja">GoogleÂÖ¨Âºè„É™„Éï„Ç°„É¨„É≥„Çπ</a>
            </span>
        </header>

        <div class="input-section">
            <div class="input-group">
                <input type="url" id="urlInput" placeholder="URL„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ (‰æã: http://localhost:3002/foo/bars/12345)"
                    value="">
                <button id="fetchButton" onclick="fetchAndDisplay()">
                    ÂèñÂæó
                </button>
            </div>

            <details style="margin-bottom: 15px;" id="authSection">
                <summary style="cursor: pointer; color: #64748b; font-size: 14px; margin-bottom: 10px;">
                    BasicË™çË®º„ÅåÂøÖË¶Å„Å™Â†¥Âêà
                    <span id="authStatus" style="margin-left: 8px; font-size: 12px; color: #10b981;"></span>
                </summary>
                <div style="margin-top: 10px;">
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
                        <input type="text" id="username" placeholder="„É¶„Éº„Ç∂„ÉºÂêç"
                            style="padding: 8px 12px; border: 1px solid #d1d5db; border-radius: 4px; font-size: 14px;">
                        <div style="position: relative;">
                            <input type="password" id="password" placeholder="„Éë„Çπ„ÉØ„Éº„Éâ"
                                style="padding: 8px 40px 8px 12px; border: 1px solid #d1d5db; border-radius: 4px; font-size: 14px; width: 100%;">
                            <button type="button" id="togglePassword" onclick="togglePasswordVisibility()"
                                style="position: absolute; right: 8px; top: 50%; transform: translateY(-50%); background: transparent; border: none; padding: 4px 8px; cursor: pointer; color: #64748b; font-size: 14px;"
                                title="„Éë„Çπ„ÉØ„Éº„Éâ„ÇíË°®Á§∫/ÈùûË°®Á§∫">
                                üëÅ
                            </button>
                        </div>
                    </div>
                    <div style="display: flex; gap: 8px; margin-top: 10px;">
                        <label style="display: flex; align-items: center; gap: 6px; font-size: 14px; color: #64748b;">
                            <input type="checkbox" id="rememberAuth" onchange="handleRememberAuth()"
                                style="width: 16px; height: 16px;">
                            <span>Ë™çË®ºÊÉÖÂ†±„ÇíË®òÊÜ∂„Åô„ÇãÔºà„Åì„ÅÆ„Éñ„É©„Ç¶„Ç∂„ÅÆ„ÅøÔºâ</span>
                        </label>
                        <button type="button" onclick="clearAuth()"
                            style="margin-left: auto; padding: 4px 12px; background: #ef4444; color: white; border: none; border-radius: 4px; font-size: 13px; cursor: pointer;">
                            Ë™çË®ºÊÉÖÂ†±„Çí„ÇØ„É™„Ç¢
                        </button>
                    </div>
                    <div
                        style="margin-top: 8px; padding: 10px; background: #dcfce7; border: 1px solid #86efac; border-radius: 4px; font-size: 12px; color: #14532d; line-height: 1.6;">
                        <div style="display: flex; align-items: flex-start; gap: 6px;">
                            <span>üîí</span>
                            <div>
                                <strong style="color: #166534;">ÂÆåÂÖ®„É≠„Éº„Ç´„É´‰øùÂ≠ò„Éª„Éó„É©„Ç§„Éê„Ç∑„ÉºÈáçË¶ñ</strong><br>
                                ‚Ä¢ ÂÖ•Âäõ„Åï„Çå„ÅüË™çË®ºÊÉÖÂ†±„ÅØ<strong>„Åì„ÅÆ„Éñ„É©„Ç¶„Ç∂„ÅÆ„Åø„Å´‰øùÂ≠ò</strong>„Åï„Çå„Åæ„Åô<br>
                                ‚Ä¢ <strong>„Çµ„Éº„Éê„Éº„Å∏„ÅÆÈÄÅ‰ø°„ÉªË®òÈå≤„ÅØ‰∏ÄÂàáË°å„ÅÑ„Åæ„Åõ„Çì</strong><br>
                                ‚Ä¢ ÈñãÁô∫ËÄÖ„ÇÇÂê´„ÇÅ„ÄÅË™∞„ÇÇ„ÅÇ„Å™„Åü„ÅÆË™çË®ºÊÉÖÂ†±„Å´„Ç¢„ÇØ„Çª„Çπ„Åß„Åç„Åæ„Åõ„Çì<br>
                                ‚Ä¢ „Éñ„É©„Ç¶„Ç∂„ÅÆ„É≠„Éº„Ç´„É´„Çπ„Éà„É¨„Éº„Ç∏„Çí‰ΩøÁî®ÔºàCookie„Çà„ÇäÂÆâÂÖ®Ôºâ
                            </div>
                        </div>
                    </div>
                </div>
            </details>

            <div class="sample-links">
                <span>„Çµ„É≥„Éó„É´:</span>
                <a class="sample-link"
                    onclick="loadSample('https://freelance-hub.jp/project/detail/281563/')">freelance-hub</a>
                <a class="sample-link"
                    onclick="loadSample('https://freelance.levtech.jp/project/detail/28421/')">levtech</a>
                <a class="sample-link" onclick="loadSample('https://freelance-job.com/job/detail/146243')">freelance-job
                </a>
                <a class="sample-link"
                    onclick="loadSample('https://www.r-agent.com/kensaku/kyujin/20250107-188-01-052.html')">RecruitAgent
                </a>
                <a class="sample-link" onclick="loadSample('https://pe-bank.jp/project/aws/47302-18/')">PE-BANK</a>
                </a>
            </div>

            <div class="error-message" id="errorMessage"></div>

            <div class="loading" id="loading">
                <div class="spinner"></div>
                <p>„Éá„Éº„Çø„ÇíÂèñÂæó‰∏≠...</p>
            </div>

            <div class="results-section" id="results">
                <div class="stats" id="stats"></div>
                <div id="schemasContainer"></div>
            </div>
        </div>

        <script>
            // „Éó„É≠„Ç≠„Ç∑„Çµ„Éº„Éê„Éº„ÅÆURLÔºàÂøÖË¶Å„Å´Âøú„Åò„Å¶Â§âÊõ¥Ôºâ
            const PROXY_SERVER = 'http://localhost:3333';

            // „Éë„Çπ„ÉØ„Éº„Éâ„ÅÆË°®Á§∫/ÈùûË°®Á§∫„ÇíÂàá„ÇäÊõø„Åà
            function togglePasswordVisibility() {
                const passwordField = document.getElementById('password');
                const toggleButton = document.getElementById('togglePassword');

                if (passwordField.type === 'password') {
                    passwordField.type = 'text';
                    toggleButton.textContent = 'üôà';  // ÈùûË°®Á§∫„Ç¢„Ç§„Ç≥„É≥
                    toggleButton.title = '„Éë„Çπ„ÉØ„Éº„Éâ„ÇíÈùûË°®Á§∫';
                } else {
                    passwordField.type = 'password';
                    toggleButton.textContent = 'üëÅ';  // Ë°®Á§∫„Ç¢„Ç§„Ç≥„É≥
                    toggleButton.title = '„Éë„Çπ„ÉØ„Éº„Éâ„ÇíË°®Á§∫';
                }
            }

            // Ë™çË®ºÊÉÖÂ†±„ÅÆÁÆ°ÁêÜ
            const AUTH_STORAGE_KEY = 'jsonld_basic_auth';
            const DOMAIN_AUTH_PREFIX = 'jsonld_auth_';

            // „Éö„Éº„Ç∏Ë™≠„ÅøËæº„ÅøÊôÇ„Å´‰øùÂ≠ò„Åï„Çå„ÅüË™çË®ºÊÉÖÂ†±„ÇíÂæ©ÂÖÉ
            function loadStoredAuth() {
                const stored = localStorage.getItem(AUTH_STORAGE_KEY);
                if (stored) {
                    try {
                        const auth = JSON.parse(stored);
                        document.getElementById('username').value = auth.username || '';
                        document.getElementById('password').value = auth.password || '';
                        document.getElementById('rememberAuth').checked = true;
                        updateAuthStatus(true);
                    } catch (e) {
                        console.error('Failed to load stored auth:', e);
                    }
                }
            }

            // Ë™çË®ºÊÉÖÂ†±„ÅÆË®òÊÜ∂/Ëß£Èô§„ÇíÂá¶ÁêÜ
            function handleRememberAuth() {
                const remember = document.getElementById('rememberAuth').checked;
                const username = document.getElementById('username').value.trim();
                const password = document.getElementById('password').value.trim();

                if (remember) {
                    if (username || password) {
                        // Ë™çË®ºÊÉÖÂ†±„Çí‰øùÂ≠ò
                        const auth = { username, password, timestamp: Date.now() };
                        localStorage.setItem(AUTH_STORAGE_KEY, JSON.stringify(auth));
                        updateAuthStatus(true);
                    }
                } else {
                    // Ë™çË®ºÊÉÖÂ†±„ÇíÂâäÈô§
                    localStorage.removeItem(AUTH_STORAGE_KEY);
                    updateAuthStatus(false);
                }
            }

            // Ë™çË®ºÊÉÖÂ†±„Çí„ÇØ„É™„Ç¢
            function clearAuth() {
                document.getElementById('username').value = '';
                document.getElementById('password').value = '';
                document.getElementById('rememberAuth').checked = false;

                // „Ç∞„É≠„Éº„Éê„É´Ë™çË®ºÊÉÖÂ†±„ÇíÂâäÈô§
                localStorage.removeItem(AUTH_STORAGE_KEY);

                // „Éâ„É°„Ç§„É≥Âà•„ÅÆË™çË®ºÊÉÖÂ†±„ÇÇ„Åô„Åπ„Å¶ÂâäÈô§
                const keys = Object.keys(localStorage);
                keys.forEach(key => {
                    if (key.startsWith(DOMAIN_AUTH_PREFIX)) {
                        localStorage.removeItem(key);
                    }
                });

                updateAuthStatus(false);
                showMessage('„Åô„Åπ„Å¶„ÅÆË™çË®ºÊÉÖÂ†±„Çí„ÇØ„É™„Ç¢„Åó„Åæ„Åó„Åü', 'success');
            }

            // Ë™çË®ºÁä∂ÊÖã„ÅÆË°®Á§∫„ÇíÊõ¥Êñ∞
            function updateAuthStatus(isStored) {
                const statusEl = document.getElementById('authStatus');
                if (isStored) {
                    statusEl.textContent = '(‰øùÂ≠òÊ∏à„Åø)';
                    statusEl.style.color = '#10b981';
                } else {
                    statusEl.textContent = '';
                }
            }

            // „É°„ÉÉ„Çª„Éº„Ç∏Ë°®Á§∫Áî®„ÅÆ„Éò„É´„Éë„ÉºÈñ¢Êï∞
            function showMessage(message, type = 'info') {
                const errorEl = document.getElementById('errorMessage');
                errorEl.textContent = message;
                errorEl.style.background = type === 'success' ? '#d1fae5' : '#fef2f2';
                errorEl.style.borderColor = type === 'success' ? '#86efac' : '#fecaca';
                errorEl.style.color = type === 'success' ? '#065f46' : '#dc2626';
                errorEl.classList.add('active');

                // 3ÁßíÂæå„Å´Ëá™ÂãïÁöÑ„Å´ÈùûË°®Á§∫
                setTimeout(() => {
                    errorEl.classList.remove('active');
                }, 3000);
            }

            // „Çµ„Éº„Éê„Éº„Çπ„ÉÜ„Éº„Çø„Çπ„Çí„ÉÅ„Çß„ÉÉ„ÇØ
            async function checkServerStatus() {
                const statusElement = document.getElementById('serverStatus');
                try {
                    const response = await fetch(`${PROXY_SERVER}/health`);
                    if (response.ok) {
                        statusElement.textContent = '„Çµ„Éº„Éê„ÉºÁ®ºÂÉç‰∏≠';
                        statusElement.className = 'server-status';
                        return true;
                    }
                } catch (error) {
                    statusElement.textContent = '„Çµ„Éº„Éê„Éº„Ç™„Éï„É©„Ç§„É≥';
                    statusElement.className = 'server-status offline';
                    return false;
                }
            }

            // ÂàùÊúüÂåñÊôÇ„Å´„Çµ„Éº„Éê„ÉºÁä∂ÊÖã„Çí„ÉÅ„Çß„ÉÉ„ÇØ„Å®Ë™çË®ºÊÉÖÂ†±„ÇíÂæ©ÂÖÉ
            checkServerStatus();
            loadStoredAuth();

            // URL„Å´Âü∫„Å•„ÅÑ„Å¶Ë™çË®ºÊÉÖÂ†±„ÇíËá™ÂãïÂÖ•Âäõ
            function autoFillAuthForUrl(url) {
                try {
                    const urlObj = new URL(url);
                    const domainKey = DOMAIN_AUTH_PREFIX + urlObj.hostname;
                    const domainAuth = localStorage.getItem(domainKey);

                    if (domainAuth) {
                        const auth = JSON.parse(domainAuth);
                        document.getElementById('username').value = auth.username || '';
                        document.getElementById('password').value = auth.password || '';
                        showMessage(`${urlObj.hostname}„ÅÆË™çË®ºÊÉÖÂ†±„ÇíËá™ÂãïÂÖ•Âäõ„Åó„Åæ„Åó„Åü`, 'success');

                        // auth„Çª„ÇØ„Ç∑„Éß„É≥„ÇíËá™ÂãïÂ±ïÈñã
                        const authSection = document.getElementById('authSection');
                        if (authSection) {
                            authSection.open = true;
                        }
                        return true;
                    }
                } catch (e) {
                    console.log('Could not auto-fill auth:', e);
                }
                return false;
            }

            function loadSample(url) {
                document.getElementById('urlInput').value = url;
                autoFillAuthForUrl(url);
                fetchAndDisplay();
            }

            async function fetchAndDisplay() {
                const urlInput = document.getElementById('urlInput');
                const url = urlInput.value.trim();

                if (!url) {
                    showError('URL„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                    return;
                }

                if (!isValidUrl(url)) {
                    showError('ÊúâÂäπ„Å™URL„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                    return;
                }

                // „Çµ„Éº„Éê„ÉºÁä∂ÊÖã„ÇíÂÜç„ÉÅ„Çß„ÉÉ„ÇØ
                const serverOnline = await checkServerStatus();
                if (!serverOnline) {
                    showError('„Éó„É≠„Ç≠„Ç∑„Çµ„Éº„Éê„Éº„Åå„Ç™„Éï„É©„Ç§„É≥„Åß„Åô„ÄÇnode-proxy„Éï„Ç©„É´„ÉÄ„Åß "npm install && npm start" „ÇíÂÆüË°å„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ');
                    return;
                }

                showLoading(true);
                hideError();
                hideResults();

                try {
                    // BasicË™çË®º„ÅÆÊÉÖÂ†±„ÇíÂèñÂæó
                    const username = document.getElementById('username').value.trim();
                    const password = document.getElementById('password').value.trim();
                    const remember = document.getElementById('rememberAuth').checked;

                    // Ë®òÊÜ∂„Åô„Çã„Ç™„Éó„Ç∑„Éß„É≥„ÅåÊúâÂäπ„Åß„ÄÅË™çË®ºÊÉÖÂ†±„Åå„ÅÇ„ÇãÂ†¥Âêà„ÅØ‰øùÂ≠ò
                    if (remember && (username || password)) {
                        const auth = { username, password, timestamp: Date.now() };
                        localStorage.setItem(AUTH_STORAGE_KEY, JSON.stringify(auth));

                        // „Éâ„É°„Ç§„É≥„Åî„Å®„Å´„ÇÇ‰øùÂ≠ò
                        try {
                            const urlObj = new URL(url);
                            const domainKey = DOMAIN_AUTH_PREFIX + urlObj.hostname;
                            localStorage.setItem(domainKey, JSON.stringify(auth));
                        } catch (e) {
                            console.log('Could not save domain-specific auth');
                        }

                        updateAuthStatus(true);
                    }

                    // „Éó„É≠„Ç≠„Ç∑„Çµ„Éº„Éê„ÉºÁµåÁî±„Åß„Éá„Éº„Çø„ÇíÂèñÂæó
                    let proxyUrl = `${PROXY_SERVER}/proxy?url=${encodeURIComponent(url)}`;
                    if (username && password) {
                        proxyUrl += `&username=${encodeURIComponent(username)}&password=${encodeURIComponent(password)}`;
                    }

                    const response = await fetch(proxyUrl);

                    if (!response.ok) {
                        let errorMessage;
                        const contentType = response.headers.get('content-type');

                        if (contentType && contentType.includes('application/json')) {
                            try {
                                const errorData = await response.json();
                                errorMessage = errorData.message || errorData.error || `HTTP„Ç®„É©„Éº ${response.status}`;
                            } catch {
                                errorMessage = await response.text();
                            }
                        } else {
                            errorMessage = await response.text();
                        }

                        // 401„Ç®„É©„Éº„ÅÆÂ†¥Âêà„ÅØÊòéÁ¢∫„Å™„É°„ÉÉ„Çª„Éº„Ç∏„ÇíË°®Á§∫
                        if (response.status === 401) {
                            throw new Error('BasicË™çË®º„ÅåÂ§±Êïó„Åó„Åæ„Åó„Åü„ÄÇ„É¶„Éº„Ç∂„ÉºÂêç„Å®„Éë„Çπ„ÉØ„Éº„Éâ„ÇíÁ¢∫Ë™ç„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ');
                        }

                        throw new Error(errorMessage);
                    }

                    const html = await response.text();
                    const schemas = extractJsonLd(html);

                    if (schemas.length === 0) {
                        showNoData();
                    } else {
                        displaySchemas(schemas, url);
                    }
                } catch (error) {
                    console.error('Error:', error);
                    showError(`„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü: ${error.message}`);
                } finally {
                    showLoading(false);
                }
            }

            function isValidUrl(string) {
                try {
                    new URL(string);
                    return true;
                } catch (_) {
                    return false;
                }
            }

            function extractJsonLd(html) {
                const parser = new DOMParser();
                const doc = parser.parseFromString(html, 'text/html');
                const scripts = doc.querySelectorAll('script[type="application/ld+json"]');

                const schemas = [];
                scripts.forEach(script => {
                    try {
                        const json = JSON.parse(script.textContent);
                        schemas.push(json);
                    } catch (e) {
                        console.error('Failed to parse JSON-LD:', e);
                    }
                });

                return schemas;
            }

            function displaySchemas(schemas, url) {
                const container = document.getElementById('schemasContainer');
                const statsContainer = document.getElementById('stats');

                const totalProperties = schemas.reduce((acc, schema) => {
                    return acc + countProperties(schema);
                }, 0);

                statsContainer.innerHTML = `
                <div class="stat-item">
                    <span class="stat-label">„Çπ„Ç≠„Éº„ÉûÊï∞</span>
                    <span class="stat-value">${schemas.length}</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">„Éó„É≠„Éë„ÉÜ„Ç£Á∑èÊï∞</span>
                    <span class="stat-value">${totalProperties}</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">„Éâ„É°„Ç§„É≥</span>
                    <span class="stat-value">${new URL(url).hostname}</span>
                </div>
            `;

                container.innerHTML = '';

                schemas.forEach((schema, index) => {
                    const card = createSchemaCard(schema, index + 1);
                    container.appendChild(card);
                });

                showResults();
            }

            function countProperties(obj) {
                if (typeof obj !== 'object' || obj === null) return 0;

                let count = 0;
                for (let key in obj) {
                    count++;
                    if (typeof obj[key] === 'object' && obj[key] !== null) {
                        count += countProperties(obj[key]);
                    }
                }
                return count;
            }

            function createSchemaCard(schema, index) {
                const card = document.createElement('div');
                card.className = 'schema-card';

                const type = getSchemaType(schema);
                const id = `schema-${index}`;

                card.innerHTML = `
                <div class="schema-header">
                    <div>
                        <span class="schema-type">${type}</span>
                        <span class="schema-index">Schema #${index}</span>
                    </div>
                    <div class="schema-controls">
                        <div class="view-toggle">
                            <button class="active" onclick="toggleView('${id}', 'table', this)">„ÉÜ„Éº„Éñ„É´</button>
                            <button onclick="toggleView('${id}', 'json', this)">JSON</button>
                        </div>
                        <div class="doc-links">${buildDocLinks(schema)}</div>
                        <button class="copy-button" onclick="copyToClipboard('${id}', this)">
                            „Ç≥„Éî„Éº
                        </button>
                    </div>
                </div>
                <div class="schema-content" id="${id}" data-raw='${JSON.stringify(schema)}'>
                    <div class="table-view" id="${id}-table">
                        ${createTableView(schema)}
                    </div>
                    <div class="json-view hidden" id="${id}-json">
                        ${formatJson(schema)}
                    </div>
                </div>
            `;

                return card;
            }

            function toggleView(schemaId, view, button) {
                const tableView = document.getElementById(`${schemaId}-table`);
                const jsonView = document.getElementById(`${schemaId}-json`);
                const toggleButtons = button.parentElement.querySelectorAll('button');

                toggleButtons.forEach(btn => btn.classList.remove('active'));
                button.classList.add('active');

                if (view === 'table') {
                    tableView.classList.remove('hidden');
                    jsonView.classList.add('hidden');
                } else {
                    jsonView.classList.remove('hidden');
                    tableView.classList.add('hidden');
                }
            }

            function createTableView(obj, depth = 0) {
                if (Array.isArray(obj)) {
                    return createArrayView(obj, depth);
                }

                if (typeof obj === 'object' && obj !== null) {
                    return createObjectTable(obj, depth);
                }

                return formatValue(obj);
            }

            function createObjectTable(obj, depth) {
                const entries = Object.entries(obj);

                if (entries.length === 0) return '<span class="property-value">Á©∫„ÅÆ„Ç™„Éñ„Ç∏„Çß„ÇØ„Éà</span>';

                let html = '<table class="data-table"><colgroup><col class="col-prop"><col class="col-value"><col class="col-type"></colgroup>';
                html += '<thead><tr><th>„Éó„É≠„Éë„ÉÜ„Ç£</th><th>ÂÄ§</th><th>Âûã</th></tr></thead>';
                html += '<tbody>';

                entries.forEach(([key, value]) => {
                    const type = getValueType(value);
                    html += '<tr>';
                    html += `<td class="property-name">${escapeHtml(key)}</td>`;
                    html += '<td>';

                    if (typeof value === 'object' && value !== null) {
                        if (Array.isArray(value)) {
                            html += createArrayView(value, depth + 1);
                        } else {
                            html += createNestedObjectView(value, depth + 1);
                        }
                    } else {
                        html += formatValue(value, key);
                    }

                    html += '</td>';
                    html += `<td><span class="property-type">${type}</span></td>`;
                    html += '</tr>';
                });

                html += '</tbody></table>';
                return html;
            }

            function createArrayView(arr, depth) {
                if (arr.length === 0) return '<span class="property-value">Á©∫„ÅÆÈÖçÂàó</span>';

                let html = `<div class="array-list">`;
                html += `<div style="margin-bottom: 8px; color: #64748b; font-size: 13px;">ÈÖçÂàó (${arr.length}È†ÖÁõÆ)</div>`;

                arr.forEach((item, index) => {
                    html += `<div class="array-list-item">`;
                    html += `<strong style="color: #64748b; font-size: 12px;">Item ${index + 1}</strong>`;

                    if (typeof item === 'object' && item !== null) {
                        html += `<div style="margin-top: 8px;">`;
                        html += createTableView(item, depth + 1);
                        html += `</div>`;
                    } else {
                        html += `: ${formatValue(item)}`;
                    }

                    html += `</div>`;
                });

                html += `</div>`;
                return html;
            }

            function createNestedObjectView(obj, depth) {
                const id = `nested-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;
                const entries = Object.entries(obj);

                if (entries.length === 0) return '<span class="property-value">Á©∫„ÅÆ„Ç™„Éñ„Ç∏„Çß„ÇØ„Éà</span>';

                let preview = entries.slice(0, 3).map(([k, v]) => {
                    const val = typeof v === 'object' ? '...' : formatSimpleValue(v);
                    return `${k}: ${val}`;
                }).join(', ');

                if (entries.length > 3) preview += '...';

                let html = `
                <div>
                    <span class="expandable" onclick="toggleNested('${id}', this)">
                        „Ç™„Éñ„Ç∏„Çß„ÇØ„Éà {${preview}}
                    </span>
                    <div class="nested-content" id="${id}">
                        <div class="nested-object">
                            <div class="table-view">${createTableView(obj, depth)}</div>
                        </div>
                    </div>
                </div>
            `;

                return html;
            }

            function toggleNested(id, element) {
                const content = document.getElementById(id);
                element.classList.toggle('collapsed');
                content.classList.toggle('collapsed');
            }

            function formatValue(value, key) {
                if (value === null) return '<span class="property-value">null</span>';
                if (value === undefined) return '<span class="property-value">undefined</span>';

                if (typeof value === 'string') {
                    // description„Å™„Å©„ÄÅ<br> „ÅåÂê´„Åæ„Çå„ÇãÊñáÂ≠óÂàó„ÅØÊÑèÂõ≥„Åó„ÅüÊîπË°å„ÇíÂèçÊò†
                    if (hasHtmlBr(value) || (key && key.toLowerCase() === 'description')) {
                        const escaped = escapeHtml(value);
                        const withBreaks = escaped.replace(/&lt;br\s*\/?&gt;/gi, '<br>');
                        return `<span class="property-value">${withBreaks}</span>`;
                    }
                    if (value.match(/^https?:\/\//)) {
                        // ÁîªÂÉèURL„ÅØ„Çµ„É†„Éç„Ç§„É´‰ªò„Åç„ÅßË°®Á§∫
                        if (isImageUrl(value)) {
                            const safe = escapeHtml(value);
                            return `
                            <span class="image-value">
                                <img src="${safe}" alt="image" class="image-thumb" loading="lazy" referrerpolicy="no-referrer" />
                                <a href="${safe}" target="_blank" class="url-value">${safe}</a>
                            </span>
                        `;
                        }
                        return `<a href="${escapeHtml(value)}" target="_blank" class="url-value">${escapeHtml(value)}</a>`;
                    }
                    return `<span class="property-value">${escapeHtml(value)}</span>`;
                }

                if (typeof value === 'boolean') {
                    return `<span class="property-value" style="color: #dc2626;">${value}</span>`;
                }

                if (typeof value === 'number') {
                    return `<span class="property-value" style="color: #ea580c;">${value}</span>`;
                }

                return `<span class="property-value">${escapeHtml(String(value))}</span>`;
            }

            function isImageUrl(url) {
                try {
                    const u = new URL(url);
                    const pathname = u.pathname.toLowerCase();
                    return pathname.match(/\.(png|jpe?g|gif|webp|svg)$/);
                } catch (_) {
                    return false;
                }
            }

            // „Çπ„Ç≠„Éº„Éû„Çø„Ç§„Éó„Åî„Å®„ÅÆ„Éâ„Ç≠„É•„É°„É≥„Éà„É™„É≥„ÇØÁîüÊàê
            function buildDocLinks(schema) {
                const googleDocsMap = {
                    JobPosting: 'https://developers.google.com/search/docs/appearance/structured-data/job-posting?hl=ja',
                    Article: 'https://developers.google.com/search/docs/appearance/structured-data/article?hl=ja',
                    BreadcrumbList: 'https://developers.google.com/search/docs/appearance/structured-data/breadcrumb?hl=ja',
                    Product: 'https://developers.google.com/search/docs/appearance/structured-data/product?hl=ja',
                    FAQPage: 'https://developers.google.com/search/docs/appearance/structured-data/faqpage?hl=ja',
                    HowTo: 'https://developers.google.com/search/docs/appearance/structured-data/how-to?hl=ja',
                    Event: 'https://developers.google.com/search/docs/appearance/structured-data/event?hl=ja',
                    LocalBusiness: 'https://developers.google.com/search/docs/appearance/structured-data/local-business?hl=ja',
                    Organization: 'https://developers.google.com/search/docs/appearance/structured-data/logo?hl=ja',
                    WebSite: 'https://developers.google.com/search/docs/appearance/structured-data/sitelinks-searchbox?hl=ja',
                    VideoObject: 'https://developers.google.com/search/docs/appearance/structured-data/video?hl=ja',
                    Recipe: 'https://developers.google.com/search/docs/appearance/structured-data/recipe?hl=ja'
                };

                let types = [];
                if (schema && schema['@type']) {
                    types = Array.isArray(schema['@type']) ? schema['@type'] : [schema['@type']];
                } else if (schema && schema['@graph']) {
                    // @graph„ÅÆÂ†¥Âêà„ÄÅ‰ª£Ë°®ÁöÑ„Å™@type„ÇíÊäΩÂá∫
                    try {
                        const graph = Array.isArray(schema['@graph']) ? schema['@graph'] : [];
                        types = [...new Set(graph.map(n => n['@type']).filter(Boolean))].slice(0, 2);
                    } catch (_) { /* noop */ }
                }

                if (types.length === 0) return '';

                const pills = types.slice(0, 2).map(t => {
                    const sUrl = `https://schema.org/${encodeURIComponent(t)}`;
                    const gUrl = googleDocsMap[t];
                    const schemaLink = `<a class="doc-pill" target="_blank" rel="noopener noreferrer" href="${sUrl}">schema.org/${t}</a>`;
                    const googleLink = gUrl ? `<a class=\"doc-pill\" target=\"_blank\" rel=\"noopener noreferrer\" href=\"${gUrl}\">Google ${t}</a>` : '';
                    return [schemaLink, googleLink].filter(Boolean).join('');
                }).join('');

                return pills;
            }

            function hasHtmlBr(text) {
                return /<br\s*\/?\s*>/i.test(text);
            }

            function formatSimpleValue(value) {
                if (value === null) return 'null';
                if (value === undefined) return 'undefined';
                if (typeof value === 'string') return value.length > 20 ? value.substr(0, 20) + '...' : value;
                return String(value);
            }

            function getValueType(value) {
                if (value === null) return 'null';
                if (Array.isArray(value)) return 'array';
                return typeof value;
            }

            function getSchemaType(schema) {
                if (Array.isArray(schema)) {
                    return 'Array';
                }
                if (schema['@type']) {
                    if (Array.isArray(schema['@type'])) {
                        return schema['@type'].join(', ');
                    }
                    return schema['@type'];
                }
                if (schema['@graph']) {
                    return '@graph';
                }
                return 'Object';
            }

            function formatJson(obj, indent = 0) {
                const spaces = '  '.repeat(indent);

                if (obj === null) {
                    return `<span class="json-null">null</span>`;
                }

                if (typeof obj === 'boolean') {
                    return `<span class="json-boolean">${obj}</span>`;
                }

                if (typeof obj === 'number') {
                    return `<span class="json-number">${obj}</span>`;
                }

                if (typeof obj === 'string') {
                    return `<span class="json-string">"${escapeHtml(obj)}"</span>`;
                }

                if (Array.isArray(obj)) {
                    if (obj.length === 0) return '<span class="json-bracket">[]</span>';
                    let result = '<span class="json-bracket">[</span>\n';
                    obj.forEach((item, i) => {
                        result += spaces + '  ' + formatJson(item, indent + 1);
                        if (i < obj.length - 1) result += ',';
                        result += '\n';
                    });
                    result += spaces + '<span class="json-bracket">]</span>';
                    return result;
                }

                if (typeof obj === 'object') {
                    const keys = Object.keys(obj);
                    if (keys.length === 0) return '<span class="json-bracket">{}</span>';
                    let result = '<span class="json-bracket">{</span>\n';
                    keys.forEach((key, i) => {
                        result += spaces + '  ' + `<span class="json-key">"${escapeHtml(key)}"</span>: `;
                        result += formatJson(obj[key], indent + 1);
                        if (i < keys.length - 1) result += ',';
                        result += '\n';
                    });
                    result += spaces + '<span class="json-bracket">}</span>';
                    return result;
                }

                return String(obj);
            }

            function escapeHtml(text) {
                const map = {
                    '&': '&amp;',
                    '<': '&lt;',
                    '>': '&gt;',
                    '"': '&quot;',
                    "'": '&#039;'
                };
                return String(text).replace(/[&<>"']/g, m => map[m]);
            }

            async function copyToClipboard(elementId, button) {
                const element = document.getElementById(elementId);
                const rawData = element.dataset.raw;

                try {
                    const formatted = JSON.stringify(JSON.parse(rawData), null, 2);
                    await navigator.clipboard.writeText(formatted);

                    button.textContent = '„Ç≥„Éî„ÉºÂÆå‰∫Ü';
                    button.classList.add('copied');

                    setTimeout(() => {
                        button.textContent = '„Ç≥„Éî„Éº';
                        button.classList.remove('copied');
                    }, 2000);
                } catch (err) {
                    console.error('Failed to copy:', err);
                    button.textContent = '„Ç®„É©„Éº';
                    setTimeout(() => {
                        button.textContent = '„Ç≥„Éî„Éº';
                    }, 2000);
                }
            }

            function showNoData() {
                const container = document.getElementById('schemasContainer');
                container.innerHTML = `
                <div class="no-data">
                    <h3>JSON-LD„Çπ„Ç≠„Éº„Éû„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì„Åß„Åó„Åü</h3>
                    <p>„Åì„ÅÆ„Éö„Éº„Ç∏„Å´„ÅØÊßãÈÄ†Âåñ„Éá„Éº„Çø„ÅåÂê´„Åæ„Çå„Å¶„ÅÑ„Å™„ÅÑ„Çà„ÅÜ„Åß„Åô</p>
                </div>
            `;
                showResults();
            }

            function showLoading(show) {
                document.getElementById('loading').classList.toggle('active', show);
                document.getElementById('fetchButton').disabled = show;
            }

            function showError(message) {
                const errorEl = document.getElementById('errorMessage');
                errorEl.textContent = message;
                // ÊòéÁ§∫ÁöÑ„Å´„Ç®„É©„Éº„Ç´„É©„Éº„Å∏„É™„Çª„ÉÉ„ÉàÔºàÂâçÂõû„ÅÆÊàêÂäü„Çπ„Çø„Ç§„É´„ÅåÊÆã„Çâ„Å™„ÅÑ„Çà„ÅÜ„Å´Ôºâ
                errorEl.style.background = '#fef2f2';
                errorEl.style.borderColor = '#fecaca';
                errorEl.style.color = '#dc2626';
                errorEl.classList.add('active');
            }

            function hideError() {
                document.getElementById('errorMessage').classList.remove('active');
            }

            function showResults() {
                document.getElementById('results').classList.add('active');
            }

            function hideResults() {
                document.getElementById('results').classList.remove('active');
            }

            // Enter„Ç≠„Éº„Åß„ÅÆÈÄÅ‰ø°„Å´ÂØæÂøú
            document.getElementById('urlInput').addEventListener('keypress', function (e) {
                if (e.key === 'Enter') {
                    fetchAndDisplay();
                }
            });

            // URL„ÅåÂ§âÊõ¥„Åï„Çå„Åü„Å®„Åç„Å´Ë™çË®ºÊÉÖÂ†±„ÇíËá™ÂãïÂÖ•Âäõ
            document.getElementById('urlInput').addEventListener('blur', function (e) {
                const url = e.target.value.trim();
                if (url) {
                    autoFillAuthForUrl(url);
                }
            });
        </script>
</body>

</html>