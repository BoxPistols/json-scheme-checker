<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JSON-LD Schema Viewer (Proxy Version)</title>
    <link rel="icon" href="/favicon.svg" type="image/svg+xml">
    <link rel="stylesheet" href="/styles.css">
</head>

<body>
    <div class="container">
        <header>
            <h1>JSON-LD Schema Viewer</h1>
            <p class="subtitle">Webページ内のJSONスキーマ/SEO関連のチェックツール</p>
            <div class="header-actions">
                <span class="server-status" id="serverStatus">サーバー確認中...</span>
                <a class="doc-pill" target="_blank" rel="noopener noreferrer"
                    href="https://developers.google.com/search/docs/appearance/structured-data/job-posting?hl=ja">Google公式リファレンス</a>
                <button type="button" class="btn-guide" id="btnMemo">
                    メモ
                </button>
                <button type="button" class="btn-guide" id="btnGuide">
                    使い方
                </button>
            </div>
        </header>

        <div class="input-section">
            <div class="input-group">
                <input type="url" id="urlInput" placeholder="URLを入力してください (例: https://example.com/page.html)" value="">
                <button id="fetchButton">
                    取得
                </button>
            </div>
            <div class="auth-hint">
                Cmd+K / Ctrl+K でURL入力欄にフォーカス
            </div>

            <details class="auth-details" id="authSection">
                <summary class="auth-summary">
                    Basic認証が必要な場合
                    <span id="authStatus" class="auth-status"></span>
                </summary>
                <div class="auth-content">
                    <div class="auth-grid">
                        <input type="text" id="username" placeholder="ユーザー名" class="auth-input">
                        <div class="auth-password-wrapper">
                            <input type="password" id="password" placeholder="パスワード" class="auth-password-input">
                            <button type="button" id="togglePassword"
                                class="auth-toggle-btn" aria-label="パスワードを表示/非表示" title="パスワードを表示/非表示">
                                <span id="iconEye" aria-hidden="true" class="icon-visible">
                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none"
                                        xmlns="http://www.w3.org/2000/svg">
                                        <path d="M1 12s4-7 11-7 11 7 11 7-4 7-11 7-11-7-11-7z" stroke="currentColor"
                                            stroke-width="2" fill="none" />
                                        <circle cx="12" cy="12" r="3" stroke="currentColor" stroke-width="2"
                                            fill="none" />
                                    </svg>
                                </span>
                                <span id="iconEyeOff" aria-hidden="true" class="icon-hidden">
                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none"
                                        xmlns="http://www.w3.org/2000/svg">
                                        <path d="M3 3l18 18" stroke="currentColor" stroke-width="2" />
                                        <path
                                            d="M21 12s-4 7-9 7c-2.038 0-3.92-.8-5.5-1.9M3 12s4-7 9-7c2.051 0 3.936.808 5.517 1.913"
                                            stroke="currentColor" stroke-width="2" />
                                    </svg>
                                </span>
                            </button>
                        </div>
                    </div>

                    <div class="auth-section-header">
                        <label class="auth-label">
                            認証情報の保存方法
                            <button type="button" id="btnShowSecurityModal" class="auth-help-btn"
                                title="セキュリティについて">?</button>
                        </label>

                        <div class="auth-radio-group">
                            <label class="auth-radio-label">
                                <input type="radio" name="authStorage" value="none" checked
                                    class="auth-radio-input">
                                <span>保存しない（最もセキュア）</span>
                            </label>
                            <label class="auth-radio-label">
                                <input type="radio" name="authStorage" value="session"
                                    class="auth-radio-input">
                                <span>タブを閉じるまで保存（推奨）</span>
                            </label>
                            <label class="auth-radio-label">
                                <input type="radio" name="authStorage" value="persistent"
                                    class="auth-radio-input">
                                <span>24時間保存（利便性重視）</span>
                            </label>
                            <label class="auth-radio-label">
                                <input type="radio" name="authStorage" value="permanent"
                                    class="auth-radio-input">
                                <span>永続保存（期限なし）</span>
                            </label>
                        </div>
                    </div>

                    <div class="auth-actions">
                        <button type="button" id="btnClearAuth" class="auth-clear-btn">
                            すべてクリア
                        </button>
                    </div>
                </div>
            </details>

            <!-- セキュリティ解説Modal -->
            <div id="securityModal" class="modal-overlay">
                <div class="modal-container modal-container--narrow">
                    <div class="modal-header">
                        <h2>認証情報の保存について</h2>
                    </div>
                    <div class="modal-body">
                        <p>
                            Basic認証のユーザー名とパスワードをブラウザに保存する方法を選択できます。各オプションの特徴を理解して、ご自身の環境に合った方法を選択してください。
                        </p>

                        <table class="modal-table">
                            <thead>
                                <tr>
                                    <th>保存方法</th>
                                    <th>セキュリティ</th>
                                    <th>利便性</th>
                                    <th>保存期間</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><strong>保存しない</strong></td>
                                    <td class="status-high">高</td>
                                    <td class="status-low">低</td>
                                    <td>なし</td>
                                </tr>
                                <tr>
                                    <td><strong>タブを閉じるまで</strong></td>
                                    <td class="status-medium">中</td>
                                    <td class="status-medium">中</td>
                                    <td>タブを閉じるまで</td>
                                </tr>
                                <tr>
                                    <td><strong>24時間保存</strong></td>
                                    <td class="status-low">低</td>
                                    <td class="status-high">高</td>
                                    <td>24時間</td>
                                </tr>
                                <tr>
                                    <td><strong>永続保存</strong></td>
                                    <td class="status-low">極低</td>
                                    <td class="status-high">最高</td>
                                    <td>期限なし</td>
                                </tr>
                            </tbody>
                        </table>

                        <div class="modal-section-divider">
                            <h3 class="modal-subheading">各オプションの詳細</h3>

                            <div class="modal-info-box modal-info-box--green">
                                <h4>保存しない（最もセキュア）</h4>
                                <p>
                                    ページをリロードするたびに再入力が必要です。セキュリティを最優先する場合に推奨します。
                                </p>
                            </div>

                            <div class="modal-info-box modal-info-box--orange">
                                <h4>タブを閉じるまで保存（推奨）</h4>
                                <p>
                                    ブラウザのタブを閉じると自動的に削除されます。セキュリティと利便性のバランスが取れた推奨オプションです。認証情報は暗号化されて保存されます。
                                </p>
                            </div>

                            <div class="modal-info-box modal-info-box--red">
                                <h4>24時間保存（利便性重視）</h4>
                                <p>
                                    24時間後に自動的に削除されます。頻繁にアクセスする場合に便利ですが、信頼できるデバイスでのみ使用してください。認証情報は暗号化されて保存されます。
                                </p>
                            </div>

                            <div class="modal-info-box modal-info-box--red">
                                <h4>永続保存（期限なし、最もリスク高）</h4>
                                <p>
                                    期限なしで永続的に保存されます。手動でクリアするまで認証情報が残り続けます。最も利便性が高い一方、セキュリティリスクも最大です。個人デバイスで、かつ重要度の低い認証情報の場合のみ使用を検討してください。認証情報は暗号化されて保存されます。
                                </p>
                            </div>
                        </div>

                        <div class="modal-note-box">
                            <p>
                                <strong>注意:</strong>
                                暗号化は開発者ツールで見られないようにするための簡易的なものです。完全なセキュリティを保証するものではありません。重要な認証情報は「保存しない」を選択することを強く推奨します。
                            </p>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button class="btn-modal-close" id="btnCloseSecurityModal">
                            閉じる
                        </button>
                    </div>
                </div>
            </div>

            <!-- メモModal -->
            <div id="memoModal" class="modal-overlay">
                <div class="modal-container">
                    <div class="modal-header modal-header--sticky">
                        <h2>メモ管理</h2>
                    </div>
                    <div class="modal-body">
                        <div class="memo-actions">
                            <button class="btn-memo-action" id="btnAddMemo">
                                ➕ 新規メモ作成
                            </button>
                            <div class="memo-import-export">
                                <button class="btn-memo-action btn-memo-action--secondary" id="btnExportMemos">
                                    📤 エクスポート
                                </button>
                                <button class="btn-memo-action btn-memo-action--secondary" id="btnImportMemos">
                                    📥 インポート
                                </button>
                                <input type="file" id="memoFileInput" accept=".json" style="display: none;">
                            </div>
                        </div>
                        
                        <div id="memoList" class="memo-list">
                            <!-- メモ一覧がここに表示されます -->
                        </div>
                        
                        <div id="noMemos" class="no-memos">
                            <p>メモがまだありません</p>
                            <p class="no-memos-hint">「新規メモ作成」ボタンからメモを追加できます</p>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button class="btn-modal-close" id="btnCloseMemoModal">
                            閉じる
                        </button>
                    </div>
                </div>
            </div>

            <!-- メモ編集Modal -->
            <div id="memoEditModal" class="modal-overlay">
                <div class="modal-container modal-container--narrow">
                    <div class="modal-header">
                        <h2 id="memoEditTitle">新規メモ作成</h2>
                    </div>
                    <div class="modal-body">
                        <input type="hidden" id="memoEditId">
                        <div class="memo-form-group">
                            <label for="memoEditTitleInput" class="memo-form-label">タイトル</label>
                            <input type="text" id="memoEditTitleInput" class="memo-form-input" placeholder="メモのタイトルを入力">
                        </div>
                        <div class="memo-form-group">
                            <label for="memoEditContent" class="memo-form-label">内容</label>
                            <textarea id="memoEditContent" class="memo-form-textarea" rows="10" placeholder="メモの内容を入力"></textarea>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button class="btn-modal-cancel" id="btnCancelMemoEdit">
                            キャンセル
                        </button>
                        <button class="btn-modal-primary" id="btnSaveMemo">
                            保存
                        </button>
                    </div>
                </div>
            </div>

            <!-- 使い方解説Modal -->
            <div id="guideModal" class="modal-overlay">
                <div class="modal-container">
                    <div class="modal-header modal-header--sticky">
                        <h2>JSON-LD Schema Viewerの使い方</h2>
                    </div>
                    <div class="modal-body">
                        <!-- アプリの概要 -->
                        <section class="modal-section">
                            <h3>このアプリについて</h3>
                            <p>
                                JSON-LD Schema Viewerは、WebサイトのJSON-LD構造化データを抽出して可視化するツールです。
                            </p>
                            <ul>
                                <li>CORSプロキシサーバーを使用してあらゆるURLにアクセス可能</li>
                                <li>開発中のlocalhostサイトも検証可能</li>
                                <li>テーブル形式とJSON形式の切り替え表示</li>
                                <li>Basic認証が必要なサイトにも対応</li>
                            </ul>
                        </section>

                        <!-- 基本的な使い方 -->
                        <section class="modal-section">
                            <h3>基本的な使い方</h3>
                            <ol>
                                <li><strong>URLを入力:</strong> 検証したいWebサイトのURLを入力欄に貼り付けます</li>
                                <li><strong>取得ボタンをクリック:</strong> 「取得」ボタンをクリックしてJSON-LDを抽出します</li>
                                <li><strong>結果を確認:</strong> 抽出されたJSON-LDがテーブル形式で表示されます</li>
                                <li><strong>表示切り替え:</strong> 「JSON」タブで生のJSON形式でも確認できます</li>
                                <li><strong>コピー:</strong> 「コピー」ボタンでJSON-LDをクリップボードにコピーできます</li>
                            </ol>
                            <div class="modal-info-box modal-info-box--blue">
                                <p>
                                    <strong>ヒント:</strong> Cmd+K（Mac）またはCtrl+K（Windows）でURL入力欄に素早くフォーカスできます。
                                </p>
                            </div>
                        </section>

                        <!-- サンプルリンクの使い方 -->
                        <section class="modal-section">
                            <h3>サンプルリンクの使い方</h3>
                            <p>
                                入力欄の下にある「サンプル」リンクをクリックすると、実際のWebサイトのJSON-LDを確認できます。初めて使う方は、まずサンプルリンクから試してみてください。
                            </p>
                        </section>

                        <!-- Basic認証について -->
                        <section class="modal-section">
                            <h3>Basic認証が必要なサイトの検証</h3>
                            <p>
                                パスワード保護されたサイト（ステージング環境など）を検証する場合：
                            </p>
                            <ol>
                                <li>「Basic認証が必要な場合」セクションを展開</li>
                                <li>ユーザー名とパスワードを入力</li>
                                <li>認証情報の保存方法を選択（推奨：タブを閉じるまで保存）</li>
                                <li>URLを入力して「取得」ボタンをクリック</li>
                            </ol>
                            <div class="modal-info-box modal-info-box--yellow">
                                <p>
                                    <strong>セキュリティ:</strong> 認証情報はブラウザのみに保存され、サーバーには送信されません。重要な認証情報は「保存しない」を選択してください。
                                </p>
                            </div>
                        </section>

                        <!-- 表示モードの切り替え -->
                        <section class="modal-section">
                            <h3>表示モードの切り替え</h3>
                            <table class="modal-table">
                                <thead>
                                    <tr>
                                        <th>モード</th>
                                        <th>説明</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td><strong>テーブル</strong></td>
                                        <td>プロパティ名、値、型が見やすく表示されます。階層構造も分かりやすく表示されます。</td>
                                    </tr>
                                    <tr>
                                        <td><strong>JSON</strong></td>
                                        <td>生のJSON形式で表示されます。シンタックスハイライト付きで読みやすくフォーマットされています。</td>
                                    </tr>
                                </tbody>
                            </table>
                        </section>

                        <!-- 便利な機能 -->
                        <section class="modal-section">
                            <h3>便利な機能</h3>
                            <ul>
                                <li><strong>スキーマ統計:</strong> 検出されたスキーマ数、プロパティ総数、ドメイン情報を表示</li>
                                <li><strong>Schema.orgリンク:</strong> 各スキーマタイプの公式ドキュメントへのリンクを自動生成</li>
                                <li><strong>Googleリファレンス:</strong> Googleの構造化データガイドへのリンクを提供</li>
                                <li><strong>画像サムネイル:</strong> 画像URLは自動的にサムネイル表示されます</li>
                                <li><strong>展開/折りたたみ:</strong> ネストされたオブジェクトをクリックして展開・折りたたみできます</li>
                                <li><strong>コピー機能:</strong> 各スキーマをワンクリックでクリップボードにコピー</li>
                            </ul>
                        </section>

                        <!-- タブ機能の説明 -->
                        <section class="modal-section">
                            <h3>タブ機能</h3>
                            <p>
                                結果は4つのタブで表示されます：
                            </p>
                            <ul>
                                <li><strong>Schema:</strong> JSON-LD構造化データの詳細表示</li>
                                <li><strong>HTML構造:</strong> ページのHTML要素数や見出しタグの分析</li>
                                <li><strong>概要・メタタグ:</strong> SEOスコアとメタタグの検証結果</li>
                                <li><strong>SNS:</strong> Open GraphとTwitter Cardsの設定確認</li>
                            </ul>
                        </section>
                    </div>
                    <div class="modal-footer">
                        <button class="btn-modal-close" id="btnCloseGuideModal">
                            閉じる
                        </button>
                    </div>
                </div>
            </div>

            <div class="sample-links">
                <span>サンプル:</span>
                <a class="sample-link"
                    data-sample-url="https://freelance-hub.jp/project/detail/281563/">freelance-hub</a>
                <a class="sample-link"
                    data-sample-url="https://freelance.levtech.jp/project/detail/28421/">levtech</a>
                <a class="sample-link" data-sample-url="https://freelance-job.com/job/detail/146243">freelance-job
                </a>
                <a class="sample-link"
                    data-sample-url="https://www.r-agent.com/kensaku/kyujin/20250107-188-01-052.html">RecruitAgent
                </a>
                <a class="sample-link" data-sample-url="https://pe-bank.jp/project/aws/47302-18/">PE-BANK</a>
            </div>

            <div class="error-message" id="errorMessage">
                <span id="errorMessageText"></span>
                <button type="button" id="btnHideError" class="error-close-btn" aria-label="閉じる"
                    title="閉じる">×</button>
            </div>

            <div class="loading" id="loading">
                <div class="spinner"></div>
                <p>データを取得中...</p>
            </div>

            <div class="seo-summary-section section-hidden" id="seoSummarySection">
                <div id="summaryCard"></div>
            </div>

            <div class="tab-navigation section-hidden" id="tabNavigation">
                <button class="tab-button active" data-tab="tab-schema">Schema</button>
                <button class="tab-button" data-tab="tab-html">HTML構造</button>
                <button class="tab-button" data-tab="tab-overview">概要・メタタグ</button>
                <button class="tab-button" data-tab="tab-sns">SNS</button>
            </div>

            <div class="tab-contents" id="tabContents">
                <div id="tab-schema" class="tab-content active">
                    <div class="results-section" id="results">
                        <div class="stats" id="stats"></div>
                        <div id="schemasContainer"></div>
                    </div>
                </div>
                <div id="tab-html" class="tab-content"></div>
                <div id="tab-overview" class="tab-content"></div>
                <div id="tab-sns" class="tab-content"></div>
            </div>
        </div>

        <div id="snackbar" class="snackbar" role="status" aria-live="polite" aria-atomic="true"></div>

    <script src="/app.js"></script>
    <script type="module" src="/modules/seo-analyzer.js"></script>
</body>

</html>
