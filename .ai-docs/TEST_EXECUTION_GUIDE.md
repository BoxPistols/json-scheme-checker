# テスト実行ガイド

## 環境準備

### 1. サーバー起動

```bash
pnpm start
```

正常に起動したら以下が表示されます：

```
Server running on http://localhost:3333
```

### 2. ヘルスチェック（確認）

```bash
curl http://localhost:3333/health
# 出力: {"status":"ok","timestamp":"..."}
```

### 3. ブラウザ準備

- Chrome または Edge を開く
- F12 で開発者ツールを開く
- Console タブを表示（重要：ログ確認用）

---

## テスト実行ステップ

### シナリオ 1 & 2: 求人ページテスト

**目的**: JobPosting スキーマ検出時、求人/求職アドバイスボタン**のみ**表示されることを確認

#### テストA: freelance.levtech.jp

1. ブラウザで `http://localhost:3333` にアクセス
2. URL入力欄に以下をコピペ:
   ```
   https://freelance.levtech.jp/project/detail/28421/
   ```
3. 「検索」ボタンをクリック
4. 以下を確認：
   - [ ] JSON-LD展開欄に `"@type": "JobPosting"` が表示されている
   - [ ] AI分析エリアに「**求人/求職アドバイスを受ける**」ボタン**のみ**表示
   - [ ] ブログ記事レビュー、Webページ分析ボタンは**表示されない**
   - [ ] Console（F12 → Console タブ）に以下が表示：
     ```
     [App] 以前のボタンをクリア
     [App] JobPosting検出 → Advisor
     ```

**結果**: ✅ PASS / ❌ FAIL
**理由（失敗時）**: \***\*\*\*\*\***\_\***\*\*\*\*\***

---

#### テストB: freelance-hub.jp

1. URLをクリア
2. URL入力欄に以下をコピペ:
   ```
   https://freelance-hub.jp/project/detail/281563/
   ```
3. 「検索」ボタンをクリック
4. 上記と同じ項目を確認

**結果**: ✅ PASS / ❌ FAIL
**理由（失敗時）**: \***\*\*\*\*\***\_\***\*\*\*\*\***

---

### シナリオ 3: ブログ記事ページテスト

**目的**: Article/BlogPosting スキーマ検出時、ブログ記事レビューボタン**のみ**表示されることを確認

1. URLをクリア
2. URL入力欄に以下をコピペ:
   ```
   https://zenn.dev/studio/articles/431afa748fbed1
   ```
3. 「検索」ボタンをクリック
4. 以下を確認：
   - [ ] JSON-LD展開欄に `"@type": "Article"` または `"BlogPosting"` が表示
   - [ ] AI分析エリアに「**ブログ記事レビュー**」ボタン**のみ**表示
   - [ ] 求人/求職アドバイス、Webページ分析ボタンは**表示されない**
   - [ ] Console に以下が表示：
     ```
     [App] 以前のボタンをクリア
     [App] BlogPost検出 → BlogReviewer
     ```

**結果**: ✅ PASS / ❌ FAIL
**理由（失敗時）**: \***\*\*\*\*\***\_\***\*\*\*\*\***

---

### シナリオ 4: スキーマなし一般ページテスト

**目的**: スキーマなし/WebPage のみの場合、Webページ分析ボタン**のみ**表示されることを確認

1. URLをクリア
2. URL入力欄に以下をコピペ:
   ```
   https://asagiri-design.carrd.co/
   ```
3. 「検索」ボタンをクリック
4. 以下を確認：
   - [ ] JSON-LD展開欄に排他的な分析タイプ（JobPosting/Article）が表示されていない
   - [ ] AI分析エリアに「**Webページ分析を受ける**」ボタン**のみ**表示
   - [ ] 求人/求職アドバイス、ブログ記事レビューボタンは**表示されない**
   - [ ] Console に以下が表示：
     ```
     [App] 以前のボタンをクリア
     [App] 一般的なWebページ → WebAdvisor
     ```

**結果**: ✅ PASS / ❌ FAIL
**理由（失敗時）**: \***\*\*\*\*\***\_\***\*\*\*\*\***

---

### シナリオ 5: Webページ分析の実行テスト（一般的なWebページ）

**目的**: Webページ分析が実行でき、汎用プロンプトで「ページの性質判定」が表示されることを確認

1. シナリオ 4 の終了状態から開始
2. 「Webページ分析を受ける」ボタンをクリック
3. ローディング表示が進むのを待つ
4. 分析結果が表示されたら、以下を確認：
   - [ ] 「**ページの性質判定**」セクションが表示されている（重要！）
   - [ ] 判定内容：「このページは企業サイト、ポートフォリオ...一般的なWebページと判定されます」
   - [ ] 総合評価、SEOレビュー、ユーザビリティなどのセクションが続く
   - [ ] 「BlogPostingスキーマの追加」などブログ専用の要素は含まれていない
   - [ ] Console にエラーが表示されていない

**結果**: ✅ PASS / ❌ FAIL
**理由（失敗時）**: \***\*\*\*\*\***\_\***\*\*\*\*\***

---

### シナリオ 6: Webページ分析の実行テスト（ブログ的コンテンツ）

**目的**: ブログ的なコンテンツをWebページ分析が正しく判定し、BlogPosting推奨を含めることを確認

1. URLをクリア
2. ブログ的なコンテンツを持つスキーマなしページを入力
   - 例: `https://qiita.com/YOUR_USERNAME/items/YOUR_ARTICLE_ID`
   - または同様の構成のページ（十分な本文 + 複数の見出し）
3. 「検索」ボタンをクリック
4. 「Webページ分析を受ける」ボタンをクリック
5. 分析結果で以下を確認：
   - [ ] 「**ページの性質判定**」セクションが表示
   - [ ] 判定内容：「このページはブログメディアの特徴を持っています」
   - [ ] 「**BlogPostingスキーマの追加を推奨**」が含まれている
   - [ ] ブログ専用の評価項目が表示されている
   - [ ] 「Organization」や「LocalBusiness」などの推奨は含まれていない

**結果**: ✅ PASS / ❌ FAIL
**理由（失敗時）**: \***\*\*\*\*\***\_\***\*\*\*\*\***

---

### シナリオ 7: ボタン置き換えテスト

**目的**: 複数ページ遷移時、ボタンが正しく置き換わり、重複表示がないことを確認

1. 求人ページ（シナリオ 1）を検索
2. 「求人/求職アドバイス」ボタン表示を確認
3. URLをクリア
4. ブログページ（シナリオ 3）を検索
5. 以下を確認：
   - [ ] 求人ボタンが消えている（DOM から削除されている）
   - [ ] 「ブログ記事レビュー」ボタンが表示されている
   - [ ] 2つのボタンが同時に表示されていない（重複なし）
   - [ ] Console に毎回 `[App] 以前のボタンをクリア` が表示

**結果**: ✅ PASS / ❌ FAIL
**理由（失敗時）**: \***\*\*\*\*\***\_\***\*\*\*\*\***

---

### シナリオ 8: フォールバックテンプレートテスト

**目的**: APIキーなし時も汎用テンプレートが表示されることを確認

**前提**: サーバーの環境変数 `OPENAI_API_KEY` が設定されていないこと

1. シナリオ 4（スキーマなしページ）から開始
2. 「Webページ分析を受ける」ボタンをクリック
3. ローディング後、テンプレート形式で結果が表示されたら確認：
   - [ ] 「ページの性質判定」セクションが表示
   - [ ] エラーメッセージがない
   - [ ] 「テンプレートベースで生成されました」など注釈が含まれている
   - [ ] 基本的なSEO評価が含まれている

**結果**: ✅ PASS / ❌ FAIL
**理由（失敗時）**: \***\*\*\*\*\***\_\***\*\*\*\*\***

---

## トラブルシューティング

### ボタンが複数表示される場合

**原因**: ボタンクリア処理が実行されていない可能性

**確認方法**:

1. Console で以下を実行：
   ```javascript
   console.log(window.ANALYSIS_STATE);
   ```
2. サーバーログで `[App] 以前のボタンをクリア` が表示されているか確認

**対応**:

- サーバーを再起動: `Ctrl+C` → `pnpm start`
- キャッシュクリア: ブラウザで `Ctrl+Shift+Delete`

---

### 「ページの性質判定」セクションが表示されない場合

**原因**: プロンプトが古い可能性、またはサーバーコードが更新されていない

**確認方法**:

1. サーバー再起動: `Ctrl+C` → `pnpm start`
2. ブラウザキャッシュクリア
3. 分析を再実行

**対応**:

- `api/web-advisor.js` の `buildPrompt()` を確認
- 「ページの性質を判定してから分析してください」が含まれているか確認

---

### エラーメッセージが表示される場合

**確認方法**:

1. Console のエラーメッセージ全文をコピー
2. サーバーログのエラー内容を確認
3. ネットワークタブ（F12 → Network）で失敗したリクエストを確認

---

## テスト完了後

テスト結果を以下に記入し、テスト計画書（`.ai-docs/WEB_ANALYSIS_TEST_PLAN.md`）のテスト結果セクションに記録してください。

### テスト結果サマリー

| シナリオ | テスト名                            | 結果  | 備考 |
| -------- | ----------------------------------- | ----- | ---- |
| 1        | 求人ページA（freelance.levtech.jp） | ✅/❌ |      |
| 2        | 求人ページB（freelance-hub.jp）     | ✅/❌ |      |
| 3        | ブログ記事ページ（Zenn）            | ✅/❌ |      |
| 4        | スキーマなし一般ページ              | ✅/❌ |      |
| 5        | Webページ分析実行（一般ページ）     | ✅/❌ |      |
| 6        | Webページ分析実行（ブログ的）       | ✅/❌ |      |
| 7        | ボタン置き換え                      | ✅/❌ |      |
| 8        | フォールバックテンプレート          | ✅/❌ |      |

---

最終更新: 2025-11-03
