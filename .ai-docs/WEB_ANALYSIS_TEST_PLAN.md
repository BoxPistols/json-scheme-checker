# Webページ分析テスト計画

## テスト目的

設計方針に基づいたページ分類・分析の正確性を検証する。以下を確認：

1. **排他性**: 1ページ = 1分析タイプ（複数のボタン表示がないこと）
2. **正確な分類**: JobPosting/BlogPosting/その他の検出精度
3. **Webページ分析の汎用性**: AIがページの性質を正しく判定し、適切なレビューを提供
4. **プロンプト動作**: 新しい汎用プロンプトが正常に機能

## テスト環境

- ブラウザ: Chrome 最新版（開発者ツール F12 必須）
- サーバー: `pnpm start` または `pnpm dev` で起動したローカル開発サーバー
- URL: http://localhost:3333
- コンソール確認: F12 → Console で実行ログを確認

---

## テストシナリオ

### シナリオ 1: 求人ページテスト A（freelance.levtech.jp）

**テスト名**: JobPosting検出と排他性テスト

**手順**:

1. ブラウザで http://localhost:3333 を開く
2. URL入力欄に `https://freelance.levtech.jp/project/detail/28421/` を入力
3. 「検索」ボタンをクリック
4. JSON-LD抽出完了を待つ

**期待される動作**:

- JSON-LD表示欄に JobPosting スキーマが表示される
- AI分析エリアに「**求人/求職アドバイスを受ける**」ボタン**のみ**表示
- 「ブログ記事レビュー」ボタン、「Webページ分析」ボタンは表示されない

**確認項目**:

- [ ] JobPosting スキーマが検出されている
- [ ] 「求人/求職アドバイス」ボタンのみ表示されている
- [ ] ブラウザコンソール（F12 → Console）に以下ログが表示：
  ```
  [App] 以前のボタンをクリア
  [App] JobPosting検出 → Advisor
  ```
- [ ] 他の分析ボタンは表示されていない

**テスト実行日**: **\*\***\_\_\_**\*\***
**結果**: ✅ PASS / ❌ FAIL
**備考**: \***\*\*\*\*\***\_\***\*\*\*\*\***

---

### シナリオ 2: 求人ページテスト B（freelance-hub.jp）

**テスト名**: JobPosting検出と排他性テスト（別ドメイン）

**手順**:

1. ブラウザで http://localhost:3333 を開く
2. URL入力欄に `https://freelance-hub.jp/project/detail/281563/` を入力
3. 「検索」ボタンをクリック

**期待される動作**:

- JobPosting スキーマが表示される
- 「求人/求職アドバイス」ボタン**のみ**表示

**確認項目**:

- [ ] JobPosting スキーマが検出されている
- [ ] 「求人/求職アドバイス」ボタンのみ表示
- [ ] コンソールログ: `[App] JobPosting検出 → Advisor`
- [ ] 他のボタンは表示されていない

**テスト実行日**: **\*\***\_\_\_**\*\***
**結果**: ✅ PASS / ❌ FAIL
**備考**: \***\*\*\*\*\***\_\***\*\*\*\*\***

---

### シナリオ 3: ブログ記事ページテスト（Zenn）

**テスト名**: Article/BlogPosting検出と排他性テスト

**手順**:

1. ブラウザで http://localhost:3333 を開く
2. URL入力欄に `https://zenn.dev/studio/articles/431afa748fbed1` を入力
3. 「検索」ボタンをクリック

**期待される動作**:

- Article または BlogPosting スキーマが表示される
- 「**ブログ記事レビュー**」ボタン**のみ**表示
- 他のボタンは表示されない

**確認項目**:

- [ ] Article/BlogPosting スキーマが検出されている
- [ ] 「ブログ記事レビュー」ボタンのみ表示
- [ ] コンソールログ: `[App] BlogPost検出 → BlogReviewer`
- [ ] 求人/求職アドバイスボタンは表示されていない
- [ ] Webページ分析ボタンは表示されていない

**テスト実行日**: **\*\***\_\_\_**\*\***
**結果**: ✅ PASS / ❌ FAIL
**備考**: \***\*\*\*\*\***\_\***\*\*\*\*\***

---

### シナリオ 4: スキーマなし一般ページテスト（asagiri-design）

**テスト名**: スキーマなしページのWebページ分析（一般的なWebページ）

**手順**:

1. ブラウザで http://localhost:3333 を開く
2. URL入力欄に `https://asagiri-design.carrd.co/` を入力
3. 「検索」ボタンをクリック
4. JSON-LD抽出完了を待つ

**期待される動作**:

- スキーマが表示されない、またはスキーマなし
- 「**Webページ分析を受ける**」ボタン**のみ**表示
- 他のボタンは表示されない

**確認項目**:

- [ ] 排他的な分析タイプ（JobPosting/Article）が検出されていない
- [ ] 「Webページ分析」ボタンのみ表示
- [ ] コンソールログ: `[App] 一般的なWebページ → WebAdvisor`
- [ ] 他のボタンは表示されていない

**テスト実行日**: **\*\***\_\_\_**\*\***
**結果**: ✅ PASS / ❌ FAIL
**備考**: \***\*\*\*\*\***\_\***\*\*\*\*\***

---

### シナリオ 5: Webページ分析の動作確認（一般的なWebページ）

**テスト名**: Webページ分析の実行と汎用プロンプト確認

**手順**:

1. シナリオ 4 の完了状態から開始
2. 「Webページ分析を受ける」ボタンをクリック
3. 分析結果が表示されるまで待つ

**期待される動作**:

- ローディング表示が進む
- AI分析結果が表示される
- 結果に「ページの性質判定」セクションが含まれている
  - 「このページは企業サイト、ポートフォリオ...一般的なWebページと判定されます」

**確認項目**:

- [ ] 「Webページ分析を受ける」ボタンがクリック可能
- [ ] ローディング表示が表示される
- [ ] 分析結果が流れ込む
- [ ] **「ページの性質判定」セクションが表示されている** ← 重要！
- [ ] 一般的なWebページ向けのレビュー内容
  - SEOレビュー、ユーザビリティ評価など
- [ ] ブログメディアのみの要素（BlogPostingスキーマ推奨）は含まれていない
- [ ] コンソールエラーがない

**テスト実行日**: **\*\***\_\_\_**\*\***
**結果**: ✅ PASS / ❌ FAIL
**備考**: \***\*\*\*\*\***\_\***\*\*\*\*\***

---

### シナリオ 6: Webページ分析の汎用性テスト（ブログ的コンテンツ）

**テスト名**: スキーマなしブログ的ページのWebページ分析

**手順**:

1. ブラウザで http://localhost:3333 を開く
2. ブログ的なコンテンツを持つスキーマなしページを検索
   - 例: https://qiita.com/... (Qiitaの記事)
   - または本文が長く、複数の見出しを持つページ
3. 「Webページ分析を受ける」ボタンをクリック
4. 分析結果を確認

**期待される動作**:

- 分析結果に「ページの性質判定」セクションが表示
- 「このページはブログメディアの特徴を持っています...」と判定される
- BlogPosting同様の詳細レビューが提供される
  - コンテンツ品質評価
  - 読みやすさ評価
  - **BlogPostingスキーマの追加を推奨**

**確認項目**:

- [ ] ページの性質がブログメディアと判定されている
- [ ] 「ページの性質判定」に「ブログメディアの特徴」との記述
- [ ] 「BlogPostingスキーマの追加を推奨」が含まれている
- [ ] 一般的なWebページ向けの要素（Organization, LocalBusinessなど）の推奨は含まれていない
- [ ] コンソールエラーがない

**テスト実行日**: **\*\***\_\_\_**\*\***
**結果**: ✅ PASS / ❌ FAIL
**備考**: \***\*\*\*\*\***\_\***\*\*\*\*\***

---

### シナリオ 7: 複数ページ遷移時のボタン置き換えテスト

**テスト名**: ボタンの重複表示がないことの確認

**手順**:

1. ブラウザで http://localhost:3333 を開く
2. 求人ページ（https://freelance.levtech.jp/project/detail/28421/）を検索
3. 「求人/求職アドバイス」ボタンのみ表示されることを確認
4. 別のURLをクリア・入力 → ブログ記事（https://zenn.dev/...）を検索
5. ボタンが置き換わることを確認

**期待される動作**:

- 最初: 「求人/求職アドバイス」のみ
- 2番目: 「ブログ記事レビュー」のみ（求人ボタンは消える）
- ボタンの重複表示がない

**確認項目**:

- [ ] 最初のページで求人ボタンのみ
- [ ] 2番目のページで求人ボタンが消えている
- [ ] ブログボタンが表示されている
- [ ] ボタンの重複表示なし
- [ ] コンソール: `[App] 以前のボタンをクリア` が各検索時に表示

**テスト実行日**: **\*\***\_\_\_**\*\***
**結果**: ✅ PASS / ❌ FAIL
**備考**: \***\*\*\*\*\***\_\***\*\*\*\*\***

---

### シナリオ 8: APIキーなし時のフォールバックテンプレート

**テスト名**: フォールバックテンプレートの汎用性確認

**手順**:

1. 環境変数 `OPENAI_API_KEY` が設定されていないことを確認
   - サーバーコンソールで確認、または `.env` ファイルに キーを指定しない
2. Webページ分析を実行（スキーマなしページ）
3. フォールバックテンプレートが表示されることを確認

**期待される動作**:

- 「ページの性質判定」セクションが表示
- ページの性質に応じたテンプレートが表示される
- ブログメディア判定 → BlogPosting推奨
- 一般的なWebページ判定 → 基本的なSEO提案

**確認項目**:

- [ ] フォールバックテンプレートが表示されている
- [ ] 「ページの性質判定」が含まれている
- [ ] エラーメッセージがない
- [ ] 基本的なSEO要素の評価が含まれている
- [ ] スキーマ推奨が論理的（ブログならBlogPosting、など）

**テスト実行日**: **\*\***\_\_\_**\*\***
**結果**: ✅ PASS / ❌ FAIL
**備考**: \***\*\*\*\*\***\_\***\*\*\*\*\***

---

## テスト実行チェックリスト

- [ ] シナリオ 1: 求人ページA（freelance.levtech.jp）
- [ ] シナリオ 2: 求人ページB（freelance-hub.jp）
- [ ] シナリオ 3: ブログ記事ページ（Zenn）
- [ ] シナリオ 4: スキーマなし一般ページ
- [ ] シナリオ 5: Webページ分析実行（一般ページ）
- [ ] シナリオ 6: Webページ分析実行（ブログ的コンテンツ）
- [ ] シナリオ 7: 複数ページ遷移テスト
- [ ] シナリオ 8: フォールバックテンプレート

---

## テスト実行ガイド

### サーバー起動

```bash
pnpm start  # または pnpm dev
```

ヘルスチェック:

```bash
curl http://localhost:3333/health
```

### コンソールログ確認

テスト時に以下のログを注視：

```
[App] 以前のボタンをクリア                    ← ボタンクリア実行
[App] JobPosting検出 → Advisor               ← 求人検出
[App] BlogPost検出 → BlogReviewer            ← ブログ検出
[App] 一般的なWebページ → WebAdvisor        ← Web分析ルーティング
```

### デバッグコマンド（必要に応じて）

ブラウザコンソール（F12）で実行：

```javascript
// グローバル分析状態確認
console.log(window.ANALYSIS_STATE);

// 前回のボタン手動クリア（デバッグ用）
if (typeof advisorManager !== 'undefined') {
  advisorManager.hideAdvisorButton();
}
if (typeof blogReviewerManager !== 'undefined') {
  blogReviewerManager.hideReviewButton();
}
if (typeof webAdvisorManager !== 'undefined') {
  webAdvisorManager.hideAnalysisButton();
}
```

---

## テスト結果サマリー

**総テスト数**: 8
**成功数**: **\_**
**失敗数**: **\_**
**成功率**: **\_**%

### 失敗した項目

（失敗がある場合は記入）

| シナリオ | 内容 | 原因 | 対応方法 |
| -------- | ---- | ---- | -------- |
|          |      |      |          |

### 改善提案

（テスト実行中に気づいた改善点）

---

最終更新: 2025-11-03
テスト実施者: **\*\***\_\_\_**\*\***
