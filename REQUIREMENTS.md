# 要件定義書: SEO・メタ情報分析ツール

## プロジェクト概要

現在のJSON-LDビューアを拡張し、包括的なSEO・メタ情報分析ツールに進化させる。
Webページから取得できるすべてのSEO関連情報を視覚化し、開発者とSEO担当者が容易にページの最適化状況を確認できるツールを提供する。

---

## 目的

- **現状**: JSON-LD構造化データのみを表示
- **目標**: HTML内のすべてのSEO関連要素を網羅的に分析・表示
- **ターゲットユーザー**: Web開発者、SEO担当者、マーケター

---

## 機能要件

### 1. 基本情報セクション

#### 1.1 ページ基本情報

| 項目 | 内容 | 優先度 |
|------|------|--------|
| ページタイトル | `<title>` タグの内容と文字数（推奨: 50-60文字） | 高 |
| URL | 現在のページURL | 高 |
| 文字エンコーディング | charset属性 | 中 |
| 言語設定 | `<html lang="">` 属性 | 中 |
| ページサイズ | HTMLのバイト数 | 低 |

**検証ルール:**

- タイトル文字数が60文字を超える場合は警告表示
- タイトルが空の場合はエラー表示

---

### 2. メタタグ分析セクション

#### 2.1 基本メタタグ

| タグ | 説明 | 優先度 |
|------|------|--------|
| `<meta name="description">` | ページ概要（推奨: 120-160文字） | 高 |
| `<meta name="keywords">` | キーワード（現在は非推奨だが表示） | 低 |
| `<meta name="robots">` | クローラー制御（index/noindex等） | 高 |
| `<meta name="viewport">` | レスポンシブ設定 | 中 |
| `<meta name="author">` | 著者情報 | 低 |
| `<link rel="canonical">` | 正規URL | 高 |
| `<link rel="alternate">` | 代替ページ（hreflang等） | 中 |

**検証ルール:**

- description文字数が160文字を超える場合は警告
- robotsタグでnoindexが設定されている場合は警告
- canonicalタグが複数ある場合はエラー

#### 2.2 ステータス表示

各メタタグに対して以下のステータスを表示:

- ✓ 正常（緑）
- ⚠ 警告（黄）
- ✗ エラー/未設定（赤）

---

### 3. Open Graph (OG) タグセクション

#### 3.1 対象タグ

| タグ | 必須 | 説明 |
|------|------|------|
| `og:title` | ○ | SNSシェア時のタイトル |
| `og:description` | ○ | SNSシェア時の説明 |
| `og:image` | ○ | SNSシェア時の画像 |
| `og:url` | ○ | 正規URL |
| `og:type` | ○ | コンテンツタイプ（article/website等） |
| `og:site_name` | - | サイト名 |
| `og:locale` | - | 言語・地域 |
| `og:video` | - | 動画URL（あれば） |

**表示方法:**

- OGP画像はサムネイル表示（200px幅）
- 画像URLをクリックすると新規タブで開く
- SNSプレビューのシミュレーション表示（Facebook/LinkedIn風）

**検証ルール:**

- 必須タグが欠けている場合は警告
- 画像URLが無効な場合はエラー
- 画像サイズが小さすぎる場合は警告（推奨: 1200x630px）

---

### 4. Twitter Cardsセクション

#### 4.1 対象タグ

| タグ | 必須 | 説明 |
|------|------|------|
| `twitter:card` | ○ | カードタイプ（summary/summary_large_image等） |
| `twitter:title` | ○ | タイトル |
| `twitter:description` | ○ | 説明 |
| `twitter:image` | ○ | 画像URL |
| `twitter:site` | - | サイトの@アカウント |
| `twitter:creator` | - | 作成者の@アカウント |

**表示方法:**

- Twitter Card画像をサムネイル表示
- Twitterプレビューのシミュレーション表示

**検証ルール:**

- 必須タグが欠けている場合は警告
- cardタイプが不正な値の場合はエラー

---

### 5. 構造化データセクション（既存機能の強化）

#### 5.1 現在の機能

- JSON-LDスキーマの抽出と表示
- テーブルビュー/JSONビューの切り替え

#### 5.2 強化ポイント

| 機能 | 説明 |
|------|------|
| バリデーション | Google Rich Results Testへのリンク追加 |
| スキーマタイプ統計 | 検出されたスキーマタイプの一覧表示 |
| エラー検出 | 必須プロパティの欠落を検出 |
| Microdataサポート | JSON-LD以外のフォーマット対応 |

---

### 6. 見出し構造セクション

#### 6.1 分析内容

| 項目 | 説明 |
|------|------|
| 見出し階層表示 | H1-H6をツリー構造で表示 |
| H1カウント | H1タグの数（推奨: 1つ） |
| 階層スキップ検出 | H2の後にH4が来る等の問題を検出 |
| 見出しテキスト長 | 各見出しの文字数表示 |
| 空見出し検出 | テキストが空の見出しタグを検出 |

**表示方法:**

```
H1: メインタイトル (20文字)
  H2: セクション1 (12文字)
    H3: サブセクション (15文字)
  H2: セクション2 (10文字)
    H3: サブセクション (18文字)
```

**検証ルール:**

- H1が0個または2個以上の場合は警告
- 階層がスキップされている場合は警告
- 空の見出しタグがある場合はエラー

---

### 7. リンク分析セクション

#### 7.1 分析内容

| 項目 | 説明 |
|------|------|
| 内部リンク数 | 同一ドメインへのリンク |
| 外部リンク数 | 外部ドメインへのリンク |
| nofollow/sponsored | SEO属性付きリンク数 |
| 壊れたリンク検出 | `href="#"` や空のhref |
| target="_blank"チェック | 外部リンクに適切に設定されているか |

**表示方法:**

- 統計情報を数値で表示
- リンク一覧をテーブルで表示（オプションで展開）
- nofollowリンクは色分け表示

---

### 8. 画像分析セクション

#### 8.1 分析内容

| 項目 | 説明 |
|------|------|
| 総画像数 | `<img>` タグの総数 |
| alt属性なし | altが空または未設定の画像数 |
| loading属性 | lazy/eagerの使用状況 |
| 画像サイズ | width/height属性の設定状況 |
| 形式統計 | jpg/png/webp/svg等の使用比率 |

**表示方法:**

- 統計情報を数値・グラフで表示
- alt未設定の画像一覧（サムネイル付き）

**検証ルール:**

- alt属性がない画像が5個以上ある場合は警告
- loading="lazy"が未使用の場合は提案

---

### 9. hreflang分析セクション

#### 9.1 分析内容

| 項目 | 説明 |
|------|------|
| hreflang属性一覧 | 設定されている言語・地域コード |
| x-default設定 | デフォルト言語の設定有無 |
| 相互参照チェック | 各言語ページが相互にリンクしているか |

**表示方法:**

```
ja-JP: https://example.com/ja/
en-US: https://example.com/en/
x-default: https://example.com/
```

---

### 10. パフォーマンス・技術情報セクション

#### 10.1 分析内容

| 項目 | 説明 |
|------|------|
| HTMLサイズ | バイト数とKB表示 |
| DOM要素数 | 総要素数 |
| スクリプト数 | `<script>` タグの数 |
| スタイルシート数 | `<link rel="stylesheet">` の数 |
| favicon設定 | faviconの有無 |

---

## UI/UX要件

### 11. 画面レイアウト

#### 11.1 全体構成

```
┌─────────────────────────────────────┐
│ ヘッダー（タイトル・URL入力欄）      │
├─────────────────────────────────────┤
│ サマリーカード（スコア・統計情報）   │
├─────────────────────────────────────┤
│ タブナビゲーション                   │
│ [メタ][OG][Twitter][構造化][見出し] │
├─────────────────────────────────────┤
│ セクションコンテンツ                 │
│ （選択されたタブの詳細情報）         │
└─────────────────────────────────────┘
```

#### 11.2 タブ構成案

1. **概要** - サマリー・基本情報
2. **メタタグ** - title/description/robots等
3. **SNS** - OGタグ・Twitter Cards
4. **構造化データ** - JSON-LD・Microdata
5. **見出し** - H1-H6構造
6. **リンク** - 内部/外部リンク分析
7. **画像** - alt属性・画像統計
8. **技術** - hreflang・パフォーマンス

#### 11.3 カラーコーディング

- 成功/正常: 緑 `#10b981`
- 警告: 黄 `#f59e0b`
- エラー/重要: 赤 `#ef4444`
- 情報: 青 `#3b82f6`
- グレー: `#64748b`

---

### 12. SEOスコア機能

#### 12.1 スコアリング基準

各カテゴリを100点満点で評価:

| カテゴリ | 配点 | 評価基準 |
|----------|------|----------|
| 基本メタタグ | 25点 | title/description/canonicalの適切な設定 |
| SNS最適化 | 15点 | OGタグ・Twitter Cardsの完全性 |
| 構造化データ | 20点 | JSON-LDの有無・適切性 |
| 見出し構造 | 15点 | H1-H6の階層的な使用 |
| 画像最適化 | 10点 | alt属性の設定率 |
| リンク品質 | 10点 | 内部リンク・外部リンクのバランス |
| 技術最適化 | 5点 | hreflang・パフォーマンス |

**合計スコア表示:**

```
SEOスコア: 85/100
優秀  |████████░░| 85%
```

---

### 13. エクスポート機能

#### 13.1 対応形式

| 形式 | 内容 |
|------|------|
| JSON | すべての分析データ |
| CSV | 画像一覧・リンク一覧等の表形式データ |
| PDF | レポート形式（将来対応） |
| クリップボード | 選択したセクションのコピー |

---

### 14. URL比較・差分検出機能（Diff機能）

#### 14.1 機能概要

2つのURLを比較し、SEO要素の差分を視覚的に表示する。主に以下のユースケースを想定：

- A/Bテスト前後の比較
- リニューアル前後の比較
- 競合サイトとの比較
- 異なる言語バージョンの比較
- 求人ページの差分確認（同じサイト内の2つの求人URLなど）

#### 14.2 比較対象データ

| カテゴリ | 比較内容 |
|----------|----------|
| 基本メタタグ | title/description/canonical/robots等の差分 |
| SNSタグ | OG/Twitter Cardsの差分 |
| 構造化データ | JSON-LDスキーマの差分（追加/削除/変更） |
| 見出し構造 | H1-H6の階層・テキストの差分 |
| 画像 | 画像URL・alt属性の差分 |
| リンク | 追加/削除されたリンクの検出 |
| SEOスコア | スコアの増減と要因分析 |

#### 14.3 UI設計

**入力エリア:**

```
┌─────────────────────────────────────────────────┐
│ URL 1: [_____________________________] [分析]  │
│ URL 2: [_____________________________] [分析]  │
│                           [比較を実行] ボタン   │
└─────────────────────────────────────────────────┘
```

**比較結果表示:**

```
┌──────────────────┬──────────────────┬──────────────────┐
│ 項目             │ URL 1            │ URL 2            │
├──────────────────┼──────────────────┼──────────────────┤
│ Title            │ タイトルA        │ タイトルB        │
│                  │                  │ [変更あり 🔄]    │
├──────────────────┼──────────────────┼──────────────────┤
│ Description      │ 説明A (155文字)  │ 説明B (140文字)  │
│                  │                  │ [変更あり 🔄]    │
├──────────────────┼──────────────────┼──────────────────┤
│ OG Image         │ image1.jpg       │ image2.jpg       │
│                  │ [画像プレビュー] │ [画像プレビュー] │
│                  │                  │ [変更あり 🔄]    │
├──────────────────┼──────────────────┼──────────────────┤
│ JSON-LD スキーマ │ JobPosting (1)   │ JobPosting (1)   │
│                  │                  │ [同一 ✓]         │
├──────────────────┼──────────────────┼──────────────────┤
│ SEOスコア        │ 85/100           │ 72/100           │
│                  │                  │ [-13点 ⚠]        │
└──────────────────┴──────────────────┴──────────────────┘
```

#### 14.4 差分ハイライト表示

**3つの状態を色分け:**

- **同一**: 緑背景 `#d1fae5` + チェックマーク ✓
- **変更**: 黄背景 `#fef3c7` + 変更アイコン 🔄
- **追加/削除**: 青背景（追加）`#dbeafe` / 赤背景（削除）`#fee2e2`

**テキスト差分の詳細表示:**

```
Title差分:
[-削除されたテキスト-]
[+追加されたテキスト+]
```

#### 14.5 構造化データ（JSON-LD）の差分検出

**スキーマレベルの比較:**

- スキーマタイプの追加/削除
- プロパティの追加/削除/変更
- 配列要素の増減

**表示例:**

```
JobPosting スキーマの差分:
✓ @type: JobPosting (同一)
🔄 title: "エンジニア募集A" → "エンジニア募集B"
🔄 baseSalary.value: 500000 → 600000
➕ educationRequirements: "大卒以上" (追加)
➖ experienceRequirements: "3年以上" (削除)
```

#### 14.6 求人ページ特化の差分検出

求人サイトのURLを比較する場合、以下の項目を重点的にチェック:

| 項目 | 説明 |
|------|------|
| 職種名（title） | タイトル・見出しの差分 |
| 給与情報 | baseSalary/salaryの差分 |
| 勤務地 | jobLocation/addressLocality |
| 雇用形態 | employmentType |
| 必須スキル | skills/qualifications |
| 応募締切 | validThrough |
| 企業情報 | hiringOrganization |

**求人比較モード:**

```
┌─────────────────────────────────────────────────┐
│ 🎯 求人比較モード                               │
│                                                 │
│ 求人A: フロントエンドエンジニア                 │
│ 給与: 500万円 | 勤務地: 東京 | 正社員           │
│                                                 │
│ 求人B: バックエンドエンジニア                   │
│ 給与: 600万円 | 勤務地: 大阪 | 契約社員         │
│                                                 │
│ 主な差分:                                       │
│ • 職種: フロントエンド → バックエンド          │
│ • 給与: +100万円                                │
│ • 勤務地: 東京 → 大阪                          │
│ • 雇用形態: 正社員 → 契約社員                  │
└─────────────────────────────────────────────────┘
```

#### 14.7 差分サマリー

比較結果の上部に、変更箇所のサマリーを表示:

```
📊 差分サマリー
─────────────────────────────────
✓ 同一: 15項目
🔄 変更: 8項目
➕ 追加: 3項目
➖ 削除: 2項目
─────────────────────────────────
主な変更点:
• タイトルが変更されました
• OG画像が変更されました
• JSON-LDに新しいプロパティが追加されました
• SEOスコアが13点低下しました
```

#### 14.8 エクスポート機能

比較結果を以下の形式でエクスポート:

| 形式 | 内容 |
|------|------|
| JSON | 差分データの完全なJSON |
| Markdown | レポート形式のMarkdownテーブル |
| CSV | 差分一覧（項目/URL1/URL2/差分タイプ） |
| PDF | 視覚的な比較レポート（将来対応） |

#### 14.9 実装アプローチ

**差分検出アルゴリズム:**

```javascript
function detectDiff(data1, data2) {
  const diff = {
    same: [],      // 同一の項目
    changed: [],   // 変更された項目
    added: [],     // data2にのみ存在
    removed: []    // data1にのみ存在
  };

  // 再帰的にオブジェクトを比較
  // テキスト差分はdiff-match-patchライブラリを使用

  return diff;
}
```

**使用ライブラリ候補:**

- `diff-match-patch`: テキスト差分検出
- `deep-diff`: オブジェクトの深い差分検出
- `json-diff`: JSON構造の差分検出

#### 14.10 将来拡張: 複数URL比較

3つ以上のURLを横並びで比較:

```
┌──────────┬──────────┬──────────┬──────────┐
│ 項目     │ URL A    │ URL B    │ URL C    │
├──────────┼──────────┼──────────┼──────────┤
│ スコア   │ 85       │ 72       │ 91       │
│ OG       │ ○        │ △        │ ○        │
│ JSON-LD  │ 2        │ 0        │ 3        │
└──────────┴──────────┴──────────┴──────────┘
```

---

## 非機能要件

### 15. パフォーマンス

- ページ分析は5秒以内に完了
- UIレスポンスは100ms以内
- 大規模HTML（1MB以上）でもブラウザがフリーズしない

### 16. 互換性

- モダンブラウザ対応（Chrome/Firefox/Safari/Edge最新版）
- レスポンシブデザイン（モバイル対応）
- localhost・LAN内サイト・本番サイトすべて対応

### 17. セキュリティ

- XSS対策（HTMLエスケープ）
- Basic認証情報はlocalStorageのみに保存
- サーバーログに認証情報を記録しない

### 18. アクセシビリティ

- キーボード操作対応
- スクリーンリーダー対応（ARIA属性）
- 色覚異常対応（色のみに依存しない表示）

---

## 技術要件

### 19. 技術スタック（現状維持）

- フロントエンド: Vanilla JavaScript（ライブラリ不使用）
- バックエンド: Node.js + Express
- プロキシ: Axios
- デプロイ: Vercel

### 20. 新規追加ライブラリ候補

| ライブラリ | 用途 | 優先度 |
|-----------|------|--------|
| cheerio | サーバーサイドHTML解析（高速） | 高 |
| validator.js | URL・メール等のバリデーション | 中 |
| chart.js | グラフ表示（統計データ可視化） | 低 |
| diff-match-patch | テキスト差分検出（比較機能用） | 中 |
| deep-diff | オブジェクトの深い差分検出（比較機能用） | 中 |

---

## 実装フェーズ

### Phase 1: 基本メタタグ分析（優先度: 高）

- タイトル・description・canonical分析
- Open Graph タグ抽出
- Twitter Cards抽出
- 基本的なバリデーション

**期間: 1-2日**

### Phase 2: 構造分析（優先度: 高）

- 見出し構造（H1-H6）分析
- リンク分析（内部/外部）
- 画像分析（alt属性チェック）

**期間: 1-2日**

### Phase 3: UI強化（優先度: 中）

- タブナビゲーション実装
- SEOスコア計算・表示
- カラーコーディング・警告表示

**期間: 2-3日**

### Phase 4: 比較・差分検出機能（優先度: 中）

- 2URL入力UI実装
- 差分検出アルゴリズム
- 差分ハイライト表示
- 求人比較モード
- 差分サマリー表示
- 比較結果エクスポート

**期間: 2-3日**

### Phase 5: 高度な機能（優先度: 低）

- hreflang分析
- パフォーマンス指標
- エクスポート機能強化
- 3つ以上のURL比較

**期間: 3-5日**

---

## 成功指標（KPI）

1. **機能網羅性**: Detailed.comの主要機能の80%以上をカバー
2. **パフォーマンス**: 分析完了時間が5秒以内
3. **ユーザビリティ**: 3クリック以内ですべての情報にアクセス可能
4. **精度**: メタタグ検出精度99%以上

---

## リスクと制約

### リスク

1. **大規模HTML処理**: 1MB以上のHTMLでブラウザが重くなる可能性
   - 対策: Web Workerでの非同期処理
2. **CORS制限**: 一部のサイトでプロキシが機能しない
   - 対策: エラーメッセージで明確に説明
3. **JavaScriptレンダリング**: SPAサイトではメタタグを取得できない
   - 対策: 制約として明記・将来的にPuppeteer対応検討

### 制約

- サーバーサイドレンダリング（SSR）サイトのみ対応
- クライアントサイドでレンダリングされるメタタグは取得不可
- Basic認証が必要なサイトは手動入力が必要

---

## 参考資料

- [Google Search Central - 構造化データ](https://developers.google.com/search/docs/appearance/structured-data)
- [Open Graph Protocol](https://ogp.me/)
- [Twitter Cards Documentation](https://developer.twitter.com/en/docs/twitter-for-websites/cards/overview/abouts-cards)
- [Schema.org](https://schema.org/)
- [Detailed SEO Extension](https://detailed.com/extension/)

---

## 承認・レビュー

- 作成日: 2025-10-12
- 作成者: Claude Code
- ステータス: ドラフト
- 次のアクション: レビュー・承認待ち
